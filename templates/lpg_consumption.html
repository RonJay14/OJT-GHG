<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="LPG Consumption" />
    <meta name="author" content="Your Name" />
    <title>LPG Consumption</title>
    <link rel="icon" href="{{ url_for('static', filename='images/bsu.png') }}" type="image/x-icon">
    <link href="{{ url_for('static', filename='css/emucss.css') }}" rel="stylesheet" />

    <!-- ✅ Bootstrap 4 CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- ✅ Font Awesome (For Icons) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <!-- ✅ Custom CSS -->
    <link href="{{ url_for('static', filename='css/emucss.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/reports.css') }}" rel="stylesheet">

    <!-- ✅ jQuery (MUST be first, before Bootstrap) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- ✅ Popper.js (Required for Bootstrap dropdowns) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <!-- ✅ Bootstrap 4 JS (Only one version) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- ✅ PDF & HTML to PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <!-- ✅ XLSX Library -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">



</head>

<body class="sb-nav-fixed">
    <!-- Navbar at the top -->
    <nav class="sb-topnav navbar navbar-expand navbar-dark"
        style="padding-left: 45px; height: 80px; padding-bottom: 15px; padding-top: 10px;">
        <!-- Campus Logo -->
        <img src="{{ url_for('static', filename='images/campuses/' + session['campus']|lower + '.png') }}"
            alt="Campus Logo" height="75" class="me-2">
        <a class="navbar-brand ps-3" href="{{ url_for('procurement_dashboard') }}">PROCUREMENT <span
                style="text-transform: uppercase; font-style: italic;">{{ session['campus'] }} REPORT</span></a>
        <!-- Spacer to push "Sign-out" to the right -->
        <div class="ms-auto"></div>

        <!-- Sign-out Icon and Link 
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('logout') }}">
                    <i class="fas fa-power-off fa-fw"></i> Sign-out
                </a>
            </li>
         </ul>-->
    </nav>

    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav" style="margin-top: 40px;">
                        <a class="nav-link mt-5" href="{{ url_for('procurement_dashboard') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>

                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse"
                            data-bs-target="#collapseAnalytics" aria-expanded="false" aria-controls="collapseAnalytics">
                            <div class="sb-nav-link-icon"><i class="fas fa-chart-bar"></i></div>
                            Analytics
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseAnalytics" aria-labelledby="headingTwo"
                            data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">

                                <a class="nav-link" href="{{ url_for('poanalytics') }}">Emission Trends</a>


                            </nav>
                        </div>

                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse"
                            data-bs-target="#collapseProcurement" aria-expanded="false"
                            aria-controls="collapseProcurement">
                            <div class="sb-nav-link-icon"><i class="fas fa-box"></i></div>
                            Consumption Report
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseProcurement" aria-labelledby="headingProcurement"
                            data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{{ url_for('food_consumption') }}">Food</a>
                                <a class="nav-link" href="{{ url_for('lpg_consumption') }}">LPG</a>
                            </nav>
                        </div>
                        <a class="nav-link" href="{{ url_for('po') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-book"></i></div>
                            User's Guide
                        </a>
                        <div class="logout-container">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link" href="{{ url_for('logout') }}">
                                        <i class="fas fa-power-off fa-fw"></i>&nbsp; Sign-out
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-4" style="background-color: rgb(235, 235, 237);">
                    <h2 class="fw-bold text-uppercase border-bottom border-3 pb-2 text-center fs-1 pt-5"
                        style="border-color: #2c3f54;">LPG Consumption Report</h2>

                    <div class="table-container" style="padding:auto">
                        <div class="table-wrapper">


                            <!-- Topnav Table (Filters & Download Button) -->
                            <div class="topnav-table d-flex align-items-center justify-content-between px-3 py-2"
                                style="padding-top: 20px !important;">
                                <!-- Filter Dropdown -->
                                <div class="dropdown">
                                    <button class="btn dropdown-toggle px-4 py-2" type="button" id="filterDropdown"
                                        data-bs-toggle="dropdown" aria-expanded="false" style="border-color: #2c3f54;">
                                        <i class="fas fa-filter"></i> Filter Options
                                    </button>
                                    <ul class="dropdown-menu p-2 shadow-lg rounded-3" aria-labelledby="filterDropdown">

                                        <!-- Year -->
                                        <li class="dropdown-submenu">
                                            <a class="dropdown-item dropdown-toggle" href="#">Year</a>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item {% if year == '' %}active{% endif %}"
                                                        href="?year=">All Years</a></li>
                                                        {% for y in range(2025, 2013, -1) %}
                                                        <li><a class="dropdown-item {% if year == y|string %}active{% endif %}"
                                                        href="?year={{ y }}">{{ y }}</a></li>
                                                {% endfor %}
                                            </ul>
                                        </li>
                                        <!-- Month -->
                                        <li class="dropdown-submenu">
                                            <a class="dropdown-item dropdown-toggle" href="#">Month</a>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item {% if month == '' %}active{% endif %}"
                                                        href="?month=">All Months</a></li>
                                                {% for m in ["January", "February", "March", "April", "May", "June",
                                                "July",
                                                "August", "September", "October", "November", "December"] %}
                                                <li><a class="dropdown-item {% if month == m %}active{% endif %}"
                                                        href="?month={{ m }}">{{ m }}</a></li>
                                                {% endfor %}
                                            </ul>
                                        </li>

                                        <!-- Office -->
                                        <li class="dropdown-submenu">
                                            <a class="dropdown-item dropdown-toggle" href="#">Office</a>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item {% if office == '' %}active{% endif %}" href="{{ url_for('food_consumption', year=request.args.get('year'), month=request.args.get('month')) }}">All Offices</a></li>
                                                {% for office_name in ['Auxillary Services', 'RGO', 'IAU', 'QAM', 'SDO', 'PDO', 'EA', 'ICT', 'CAS', 'CABE', 'CICS', 'CET', 'CTE', 'CE', 'CA', 'TAO', 'ORS', 'SFAO', 'GC', 'OLS', 'SOO', 'SD', 'OJT', 'NSTP', 'HRMO', 'RMO', 'PO', 'BO', 'CD', 'AO', 'PFMO', 'EMU', 'PSO', 'GSO', 'ESO', 'RO', 'OVCRDES', 'OVCDEA', 'OVCAA', 'OVCAF'] %}
                                                    <li>
                                                        <a class="dropdown-item {% if office == office_name %}active{% endif %}" 
                                                           href="{{ url_for('food_consumption', year=request.args.get('year'), month=request.args.get('month'), office=office_name) }}">
                                                            {{ office_name }}
                                                        </a>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </li>
                                    </ul>
                                </div>


                                <!-- Download Report Button -->
                                <div class="download-category row">
                                    <div class="dropdown  col-sm">
                                        <button class="btn dropdown-toggle px-4 py-2" type="button"
                                            id="downloadDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                                            style="border-color: #2c3f54;">
                                            <i class="fas fa-ellipsis-h"></i> Actions
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="downloadDropdown">
                                            <li><a class="dropdown-item" href="#"
                                                    onclick="openCalculatorModal(); return false;">
                                                    Calculate</a></li>
                                            <li><a class="dropdown-item" href="#"
                                                    onclick="printReport(); return false;">
                                                    Print Report</a></li>
                                        </ul>
                                    </div>
                                    <div class="dropdown col-sm">
                                        <button class="btn dropdown-toggle px-4 py-2" type="button"
                                            id="downloadDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                                            style="border-color: #2c3f54;">
                                            <i class="fas fa-download"></i> Downloads
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="downloadDropdown">
                                            <li><a class="dropdown-item" href="#"
                                                    onclick="downloadExcel(); return false;">
                                                    Excel</a></li>
                                            <li><a class="dropdown-item" href="#"
                                                    onclick="downloadCSV(); return false;">
                                                    CSV</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- ------------------------------------------------------------------------------------------------------ -->
                            <div class="table-container">
                                <div class="fade-overlay fade-left" id="fadeLeft"></div>
                                <div class="fade-overlay fade-right" id="fadeRight"></div>
                                <!-- 🚀 Left Arrow -->
                                <div class="scroll-arrow scroll-arrow-left" id="arrowLeft">
                                    &#9664; <!-- Unicode left arrow -->
                                </div>
                                <!-- 🚀 Right Arrow -->
                                <div class="scroll-arrow scroll-arrow-right" id="arrowRight">
                                    &#9654; <!-- Unicode right arrow -->
                                </div>
                                <div class="scrollable-content" id="scrollableContent">
                                    <div class="table-wrapper">
                                        <table id="reportTable" class="table">
                                            <thead>
                                                <tr>
                                                    <th>Year</th>
                                                    <th>Month</th>
                                                    <th>Office</th>
                                                    <th>Concessionaire Type</th>
                                                    <th>Qty (no. of tanks)</th>
                                                    <th>Tank Weight</th>
                                                    <th>Tank Volume</th>
                                                    <th>Total Tank Volume</th>
                                                    <th>GHG Emission (KG CO2e)</th>
                                                    <th>GHG Emission (T CO2e)</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="reportData">
                                                {% for record in lpg_data %}
                                                <tr>
                                                    <td>{{ record['YearTransact'] }}</td>
                                                    <td>{{ record['Month'] }}</td>
                                                    <td>{{ record['Office'] }}</td>
                                                    <td>{{ record['ConcessionariesType'] }}</td>
                                                    <td>{{ record['TankQuantity'] }}</td>
                                                    <td>{{ record['TankWeight'] }}</td>
                                                    <td>{{ record['TankVolume'] }}</td>
                                                    <td>{{ record['TotalTankVolume'] }}</td>
                                                    <td>{{ record['GHGEmissionKGCO2e'] }}</td>
                                                    <!-- Match the field name here -->
                                                    <td>{{ record['GHGEmissionTCO2e'] }}</td>
                                                    <!-- Match the field name here -->
                                                    <td>
                                                        <button class="delete-btn"
                                                            onclick="deleteRow('{{ record.id }}')"><i
                                                                class="fa-solid fa-trash"></i></button>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <script>
                                const arrowLeft = document.getElementById("arrowLeft");
                                const arrowRight = document.getElementById("arrowRight");

                                function updateFadeVisibility() {
                                    const { scrollLeft, scrollWidth, clientWidth } = scrollableContent;

                                    const showLeft = scrollLeft > 0;
                                    const showRight = scrollLeft < scrollWidth - clientWidth - 1;

                                    // 🌟 Fade visibility
                                    fadeLeft.classList.toggle("visible", showLeft);
                                    fadeLeft.classList.toggle("hidden", !showLeft);
                                    fadeRight.classList.toggle("visible", showRight);
                                    fadeRight.classList.toggle("hidden", !showRight);

                                    // 🡄🡆 Arrow visibility (same condition as fades)
                                    arrowLeft.classList.toggle("visible", showLeft);
                                    arrowRight.classList.toggle("visible", showRight);
                                }

                                scrollableContent.addEventListener("scroll", updateFadeVisibility);
                                window.addEventListener("resize", updateFadeVisibility);
                                document.addEventListener("DOMContentLoaded", updateFadeVisibility);

                                document.addEventListener('DOMContentLoaded', function () {
                                    const thElements = document.querySelectorAll('.table thead th');

                                    thElements.forEach(th => {
                                        th.addEventListener('mouseenter', function () {
                                            const text = this.textContent.trim();
                                            if (this.offsetWidth < this.scrollWidth) { // Check if text is truncated
                                                const tooltip = document.createElement('div');
                                                tooltip.textContent = text;
                                                tooltip.classList.add('custom-tooltip');
                                                document.body.appendChild(tooltip);

                                                const rect = this.getBoundingClientRect();
                                                tooltip.style.left = rect.left + 'px';
                                                tooltip.style.top = rect.bottom + 5 + 'px'; // Position below the th
                                            }
                                        });

                                        th.addEventListener('mouseleave', function () {
                                            const tooltip = document.querySelector('.custom-tooltip');
                                            if (tooltip) {
                                                tooltip.remove();
                                            }
                                        });
                                    });
                                });
                            </script>
                            <!-- ------------------------------------------------------------------------------------------------------ -->
                        </div>
                        <!-- Pagination -->
                        <div style="z-index: 1; position: relative;"
                            class="pagination-container d-flex justify-content-between align-items-center">
                            <!-- Previous Button -->
                            <a class="btn btn-dark {% if current_page == 1 %}disabled{% endif %}"
                                href="{{ url_for('lpg_consumption', page=current_page - 1, campus=request.args.get('campus'), category=request.args.get('category'), month=request.args.get('month'), quarter=request.args.get('quarter'), year=request.args.get('year')) }}">
                                &lsaquo; Previous
                            </a>

                            <!-- Page Indicator -->
                            <span class="page-indicator text-dark">
                                Page {{ current_page }} of {{ total_pages }}
                            </span>

                            <!-- Next Button -->
                            <a class="btn btn-dark {% if current_page == total_pages %}disabled{% endif %}"
                                href="{{ url_for('lpg_consumption', page=current_page + 1, campus=request.args.get('campus'), category=request.args.get('category'), month=request.args.get('month'), quarter=request.args.get('quarter'), year=request.args.get('year')) }}">
                                Next &rsaquo;
                            </a>
                        </div>
                    </div>

                    <BR>
                    <!-- Modal -->
                    <div id="myModal" class="modal" >
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <div class="container">
                                <div class="form-container">
                                    <h2 style="text-align: center; color: #333; margin-bottom: 20px;">LPG Consumption CO₂ Emission Calculator</h2>
                                    <form method="POST" action="{{ url_for('lpg_consumption') }}" id="lpgForm">
                                        <div class="form-group">
                                            <label for="campus">Campus:</label>
                                                <select id="campus" name="campus" class="form-control">
                                                <option value="" {% if not session.get('campus') %}selected{% endif %}></option>
                                                <option value="Alangilan" {% if session.get('campus')=='Alangilan' %}selected{% endif %}>Alangilan</option>
                                                <option value="ARASOF-Nasugbu" {% if session.get('campus')=='ARASOF-Nasugbu' %}selected{% endif %}>ARASOF-Nasugbu</option>
                                                <option value="Balayan" {% if session.get('campus')=='Balayan' %}selected{% endif %}>Balayan</option>
                                                <option value="Central" {% if session.get('campus')=='Central' %}selected{% endif %}>Central</option>
                                                <option value="JPLPC-Malvar" {% if session.get('campus')=='JPLPC-Malvar' %}selected{% endif %}>JPLPC-Malvar</option>
                                                <option value="Lemery" {% if session.get('campus')=='Lemery' %}selected{% endif %}>Lemery</option>
                                                <option value="Lipa" {% if session.get('campus')=='Lipa' %}selected{% endif %}>Lipa</option>
                                                <option value="Lobo" {% if session.get('campus')=='Lobo' %}selected{% endif %}>Lobo</option>
                                                <option value="Mabini" {% if session.get('campus')=='Mabini' %}selected{% endif %}>Mabini</option>
                                                <option value="Pablo Borbon" {% if session.get('campus')=='Pablo Borbon' %}selected{% endif %}>Pablo Borbon</option>
                                                <option value="Rosario" {% if session.get('campus')=='Rosario' %}selected{% endif %}>Rosario</option>
                                                <option value="San Juan" {% if session.get('campus')=='San Juan' %}selected{% endif %}>San Juan</option>
                                            </select>
                                        </div>
                    
                                        <div class="form-group">
                                            <label for="year">Year:</label>
                                            <select id="year" name="year" required class="form-control">
                                                <option value="2025">2025</option>
                                                <option value="2024">2024</option>
                                                <option value="2023">2023</option>
                                                <option value="2022">2022</option>
                                                <option value="2021">2021</option>
                                                <option value="2020">2020</option>
                                            </select>
                                        </div>
                    
                                        <div class="form-group">
                                            <label for="month">Month:</label>
                                            <select id="month" name="month" required class="form-control">
                                                <option value=""></option>
                                                <option value="January">January</option>
                                                <option value="February">February</option>
                                                <option value="March">March</option>
                                                <option value="April">April</option>
                                                <option value="May">May</option>
                                                <option value="June">June</option>
                                                <option value="July">July</option>
                                                <option value="August">August</option>
                                                <option value="September">September</option>
                                                <option value="October">October</option>
                                                <option value="November">November</option>
                                                <option value="December">December</option>
                                            </select>
                                        </div>
                    
                                        <div class="form-group">
                                            <label for="office">Office:</label>
                                            <select id="office" name="office" required  class="form-control">
                                                <option value=""></option>
                                                <option value="Procurement">Procurement</option>
                                                <option value="Auxiliary Services">Auxiliary Services</option>
                                                <option value="RGO">RGO</option>
                                            </select>
                                        </div>
                    
                                        <div class="form-group">
                                            <label for="concessionaires">Type of Concessionaires:</label>
                                            <select id="concessionaires" name="concessionaires" required class="form-control">
                                                <option value=""></option>
                                                <option value="Fuel">Fuel</option>
                                                <option value="Diesel">Diesel</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="qty">Qty (no. of tanks):</label>
                                            <input type="number" id="qty" name="qty" step="0.01" required class="form-control">
                                        </div>
                                        <div class="form-group">
                                            <label for="tankWeight">Tank weight (in kg):</label>
                                            <input type="number" id="tankWeight" name="tankWeight" step="0.01" required class="form-control">
                                        </div>

                                        <div class="form-group">
                                            <button type="button" onclick="calculateEmissions()" class="btn-calculate">Calculate</button>
                                        </div>

                                        <!-- GHG Emission fields -->
                                        <div class="ghg-emission-container">
                                            <div class="ghg-emission-field">
                                                <label for="GHGEmissionKGCO2e"
                                                    style="font-weight: bold; color: #333; margin-right: 10px;">GHG
                                                    Emission (KG
                                                    CO₂e):</label>
                                                <input class="form-control"type="number" id="GHGEmissionKGCO2e" name="GHGEmissionKGCO2e"
                                                    readonly
                                                    style="border: none; background: transparent; color: #555; text-align: right; width: 100px;"
                                                    value="0.00">
                                            </div>
                                            <div class="ghg-emission-field"><label for="GHGEmissionTCO2e"
                                                    style="font-weight: bold; color: #333; margin-right: 10px;">GHG
                                                    Emission (T
                                                    CO₂e):</label>
                                                <input class="form-control"type="number" id="GHGEmissionTCO2e" name="GHGEmissionTCO2e"
                                                    readonly
                                                    style="border: none; background: transparent; color: #555; text-align: right; width: 100px;"
                                                    value="0.00">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <button type="submit" onclick="closeModal()" class="btn-generate">Generate Report</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <style>
                        .modal {
                            display: none;
                            position: fixed;
                            z-index: 5;
                            left: 0;
                            top: 0;
                            width: 100%;
                            height: 100%;
                            overflow: auto;
                            background-color: rgba(0, 0, 0, 0.5);
                            animation: fadeIn 0.3s ease-in-out;
                        }
                    
                        @keyframes fadeIn {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                    
                        .modal-content {
                            background-color: #fff;
                            margin: 10% auto;
                            padding: 30px;
                            border-radius: 12px;
                            width: 50%;
                            max-width: 600px;
                            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
                            animation: slideIn 0.3s ease-in-out;
                        }
                    
                        @keyframes slideIn {
                            from { transform: translateY(-20px); opacity: 0; }
                            to { transform: translateY(0); opacity: 1; }
                        }
                    
                        .close {
                            color: #aaa;
                            float: right;
                            font-size: 28px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: color 0.2s ease-in-out;
                        }
                    
                        .close:hover {
                            color: #333;
                        }
                    
                        .form-container {
                            max-width: 100%;
                            margin: 0 auto;
                        }
                    
                        .form-group {
                            margin-bottom: 20px;
                        }
                    
                        .form-control {
                            height:max-content;
                            width: 100%;
                            padding: 12px;
                            border: 1px solid #ddd;
                            border-radius: 6px;
                            font-size: 16px;
                            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
                        }
                    
                        .form-control:focus {
                            border-color: #007bff;
                            box-shadow: 0 0 8px rgba(0, 123, 255, 0.2);
                            outline: none;
                        }
                    
                        .btn-calculate, .btn-generate {
                            width: 100%;
                            padding: 12px;
                            background-color: #007bff;
                            color: #fff;
                            border: none;
                            border-radius: 6px;
                            font-size: 16px;
                            cursor: pointer;
                            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
                        }
                    
                        .btn-calculate:hover, .btn-generate:hover {
                            background-color: #0056b3;
                            transform: translateY(-1px);
                        }
                    
                        .btn-calculate:active, .btn-generate:active {
                            transform: translateY(0);
                        }
                    
                        .ghg-emission-container {
                            background: #f9f9f9;
                            padding: 20px;
                            border-radius: 8px;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                            margin-bottom: 20px;
                            transition: box-shadow 0.2s ease-in-out;
                        }
                    
                        .ghg-emission-container:hover {
                            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
                        }
                    
                        .ghg-emission-field {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 15px;
                        }
                    
                        .ghg-emission-field label {
                            font-weight: bold;
                            color: #333;
                        }
                    
                        .ghg-emission-field input {
                            border: none;
                            background: transparent;
                            color: #555;
                            text-align: right;
                            width: 100px;
                            font-size: 16px;
                        }
                    
                        h2 {
                            text-align: center;
                            color: #333;
                            margin-bottom: 25px;
                            font-size: 24px;
                            font-weight: 600;
                        }
                    
                        .container {
                            padding: 0 20px;
                        }
                    </style>

                </div>
            </main>
        </div>
    </div>

    <script>
        function filterLPGReport() {
            const year = document.getElementById('yearFilter').value;
            const month = document.getElementById('monthFilter').value;
            const office = document.getElementById('officeFilter').value;

            // Build the query string based on selected filters
            let queryString = [];
            if (year) queryString.push(`year=${encodeURIComponent(year)}`);
            if (month) queryString.push(`month=${encodeURIComponent(month)}`);
            if (office) queryString.push(`office=${encodeURIComponent(office)}`);
            queryString = queryString.length > 0 ? '?' + queryString.join('&') : '';

            // Redirect to the current page with the query string to apply the filter or reset it
            window.location.href = window.location.pathname + queryString;
        }

        // Add event listeners to filter dropdowns
        document.addEventListener('DOMContentLoaded', function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            
            // Set initial filter values from URL parameters
            const year = urlParams.get('year') || '';
            const month = urlParams.get('month') || '';
            const office = urlParams.get('office') || '';

            // Update dropdown selections based on URL parameters
            if (document.querySelector('[href="?year=' + year + '"]')) {
                document.querySelector('[href="?year=' + year + '"]').classList.add('active');
            }
            if (document.querySelector('[href="?month=' + month + '"]')) {
                document.querySelector('[href="?month=' + month + '"]').classList.add('active');
            }
            if (document.querySelector('[href="?office=' + office + '"]')) {
                document.querySelector('[href="?office=' + office + '"]').classList.add('active');
            }
        });

        function deleteRow(recordId) {
            if (!confirm("Are you sure you want to delete this record?")) return; // Confirm deletion

            fetch(`/delete_lpg/${recordId}`, {
                method: 'DELETE'
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("Record deleted successfully.");
                        location.reload(); // Reload the page after successful deletion
                    } else {
                        alert("An error occurred while trying to delete the record.");
                    }
                })
        }



        function openCalculatorModal() {
            document.getElementById('myModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('myModal').style.display = 'none';
        }

        // Calculate CO2 Emission based on input
        function calculateEmissions() {
            const tankWeight = parseFloat(document.getElementById('tankWeight').value);
            const qty = parseFloat(document.getElementById('qty').value);
            const concessionaires = document.getElementById('concessionaires').value;

            if (!tankWeight || !qty || !concessionaires) {
                alert("Please fill in all fields before calculating.");
                return;
            }

            const factor = concessionaires === 'Fuel' || concessionaires === 'Diesel' ? 2.95795 : 0;
            const kgCO2e = factor * tankWeight;
            const tCO2e = kgCO2e / 1000;

            document.getElementById('GHGEmissionKGCO2e').value = kgCO2e.toFixed(2);
            document.getElementById('GHGEmissionTCO2e').value = tCO2e.toFixed(2);
        }


        // Dummy data for pagination and filters
        const reportData = "{{ lpg_data | safe }}";

        document.getElementById('printReportBtn').addEventListener('click', printLPGReport);

        function getCurrentFilters() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                year: urlParams.get('year') || '',
                month: urlParams.get('month') || '',
                office: urlParams.get('office') || ''
            };
        }

        function buildFilterQueryString(filters) {
            let queryParts = [];
            if (filters.year) queryParts.push(`year=${encodeURIComponent(filters.year)}`);
            if (filters.month) queryParts.push(`month=${encodeURIComponent(filters.month)}`);
            if (filters.office) queryParts.push(`office=${encodeURIComponent(filters.office)}`);
            return queryParts.length > 0 ? '?' + queryParts.join('&') : '';
        }

        function printReport() {
            // Get current filters from URL
            const filters = getCurrentFilters();
            const queryString = buildFilterQueryString(filters);

            // Fetch filtered data from the server
            fetch(`/lpg_consumption/all${queryString}`)
                .then(response => response.json())
                .then(data => {
                    if (!data || data.length === 0) {
                        alert('No data available to print.');
                        return;
                    }

                    // Create print content with filter information
                    const printContent = `
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h2>LPG Consumption Report</h2>
                            ${filters.year ? `<p>Year: ${filters.year}</p>` : ''}
                            ${filters.month ? `<p>Month: ${filters.month}</p>` : ''}
                            ${filters.office ? `<p>Office: ${filters.office}</p>` : ''}
                        </div>
                        <table border="1" style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Month</th>
                                    <th>Office</th>
                                    <th>Concessionaire Type</th>
                                    <th>Qty (no. of tanks)</th>
                                    <th>Tank Weight</th>
                                    <th>Tank Volume</th>
                                    <th>Total Tank Volume</th>
                                    <th>GHG Emission (KG CO2e)</th>
                                    <th>GHG Emission (T CO2e)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(record => `
                                    <tr>
                                        <td>${record.YearTransact || ''}</td>
                                        <td>${record.Month || ''}</td>
                                        <td>${record.Office || ''}</td>
                                        <td>${record.ConcessionariesType || ''}</td>
                                        <td>${record.TankQuantity || ''}</td>
                                        <td>${record.TankWeight || ''}</td>
                                        <td>${record.TankVolume || ''}</td>
                                        <td>${record.TotalTankVolume || ''}</td>
                                        <td>${record.GHGEmissionKGCO2e || ''}</td>
                                        <td>${record.GHGEmissionTCO2e || ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>`;

                    // Store current page content
                    const originalContent = document.body.innerHTML;
                    
                    // Replace with print content
                    document.body.innerHTML = printContent;
                    
                    // Print
                    window.print();
                    
                    // Restore original content
                    document.body.innerHTML = originalContent;
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert('An error occurred while preparing the print.');
                });
        }

        function downloadCSV() {
            // Get current filters from URL
            const filters = getCurrentFilters();
            const queryString = buildFilterQueryString(filters);

            // Fetch filtered data
            fetch(`/lpg_consumption/all${queryString}`)
                .then(response => response.json())
                .then(data => {
                    if (!data || data.length === 0) {
                        alert('No data available to export.');
                        return;
                    }

                    // Define headers
                    const headers = [
                        'Year',
                        'Month',
                        'Office',
                        'Concessionaire Type',
                        'Qty (no. of tanks)',
                        'Tank Weight',
                        'Tank Volume',
                        'Total Tank Volume',
                        'GHG Emission (KG CO2e)',
                        'GHG Emission (T CO2e)'
                    ];

                    // Prepare rows
                    const rows = data.map(record => [
                        record.YearTransact,
                        record.Month,
                        record.Office,
                        record.ConcessionariesType,
                        record.TankQuantity,
                        record.TankWeight,
                        record.TankVolume,
                        record.TotalTankVolume,
                        record.GHGEmissionKGCO2e,
                        record.GHGEmissionTCO2e
                    ]);

                    // Create CSV content
                    const csvContent = [
                        headers.join(','),
                        ...rows.map(row => row.map(cell => `"${cell || ''}"`).join(','))
                    ].join('\n');

                    // Create and trigger download
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    const filename = `LPGConsumptionReport${filters.year ? '_' + filters.year : ''}${filters.month ? '_' + filters.month : ''}${filters.office ? '_' + filters.office : ''}.csv`;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                })
                .catch(error => {
                    console.error('Error exporting data:', error);
                    alert('An error occurred while exporting the data.');
                });
        }

        function downloadExcel() {
            try {
                // Get current filters from URL
                const filters = getCurrentFilters();
                const queryString = buildFilterQueryString(filters);

                // Fetch filtered data
                fetch(`/lpg_consumption/all${queryString}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (!data || data.length === 0) {
                            alert('No data available to export.');
                            return;
                        }

                        // Prepare the data for Excel
                        const excelData = data.map(record => ({
                            'Year': record.YearTransact || '',
                            'Month': record.Month || '',
                            'Office': record.Office || '',
                            'Concessionaire Type': record.ConcessionariesType || '',
                            'Qty (no. of tanks)': record.TankQuantity || '',
                            'Tank Weight': record.TankWeight || '',
                            'Tank Volume': record.TankVolume || '',
                            'Total Tank Volume': record.TotalTankVolume || '',
                            'GHG Emission (KG CO2e)': record.GHGEmissionKGCO2e || '',
                            'GHG Emission (T CO2e)': record.GHGEmissionTCO2e || ''
                        }));

                        // Convert to worksheet
                        const ws = XLSX.utils.json_to_sheet(excelData);

                        // Create workbook and add the worksheet
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, 'LPG Consumption');

                        // Save the file with filters in filename
                        const filename = `LPGConsumptionReport${filters.year ? '_' + filters.year : ''}${filters.month ? '_' + filters.month : ''}${filters.office ? '_' + filters.office : ''}.xlsx`;
                        XLSX.writeFile(wb, filename);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while generating the Excel file.');
                    });
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while preparing the Excel download.');
            }
        }

    </script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                let currentPath = window.location.pathname;
                let sidebarLinks = document.querySelectorAll(".nav-link");
    
                sidebarLinks.forEach(link => {
                    if (link.getAttribute("href") === currentPath) {
                        link.classList.add("active");
    
                        // If the link is inside a dropdown, open the dropdown
                        let parentCollapse = link.closest(".collapse");
                        if (parentCollapse) {
                            parentCollapse.classList.add("show");
                            let dropdownToggle = document.querySelector(`[data-bs-target="#${parentCollapse.id}"]`);
                            if (dropdownToggle) {
                                dropdownToggle.classList.add("active");
                            }
                        }
                    }
                });
            });
        </script>
</body>

</html>