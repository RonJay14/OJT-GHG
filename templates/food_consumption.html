<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Food Consumption" />
    <meta name="author" content="Your Name" />
    <title>Food Consumption</title>
    <link rel="icon" href="{{ url_for('static', filename='images/bsu.png') }}" type="image/x-icon">
    <link href="{{ url_for('static', filename='css/emucss.css') }}" rel="stylesheet" />

    <!-- âœ… Bootstrap 4 CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- âœ… Font Awesome (For Icons) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <!-- âœ… Custom CSS -->
    <link href="{{ url_for('static', filename='css/emucss.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/reports.css') }}" rel="stylesheet">

    <!-- âœ… jQuery (MUST be first, before Bootstrap) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- âœ… Popper.js (Required for Bootstrap dropdowns) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <!-- âœ… Bootstrap 4 JS (Only one version) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- âœ… PDF & HTML to PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <!-- Add XLSX library -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">



</head>

<body class="sb-nav-fixed">
    <!-- Navbar at the top -->
    <nav class="sb-topnav navbar navbar-expand navbar-dark"
        style="padding-left: 45px; height: 80px; padding-bottom: 15px; padding-top: 10px;">
        <!-- Campus Logo -->
        <img src="{{ url_for('static', filename='images/campuses/' + session['campus']|lower + '.png') }}"
            alt="Campus Logo" height="75" class="me-2">
        <a class="navbar-brand ps-3" href="{{ url_for('procurement_dashboard') }}">PROCUREMENT <span
                style="text-transform: uppercase; font-style: italic;">{{ session['campus'] }} REPORT</span></a>
        <!-- Spacer to push "Sign-out" to the right -->
        <div class="ms-auto"></div>

        <!-- Sign-out Icon and Link 
         <ul class="navbar-nav">
             <li class="nav-item">
                 <a class="nav-link" href="{{ url_for('logout') }}">
                     <i class="fas fa-power-off fa-fw"></i> Sign-out
                 </a>
             </li>
         </ul>-->
    </nav>

    <!-- Sidebar and Main Content Layout -->
    <div id="layoutSidenav">
        <!-- Sidebar -->
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav" style="margin-top: 40px;">
                        <a class="nav-link mt-5" href="{{ url_for('procurement_dashboard') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>

                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse"
                            data-bs-target="#collapseAnalytics" aria-expanded="false" aria-controls="collapseAnalytics">
                            <div class="sb-nav-link-icon"><i class="fas fa-chart-bar"></i></div>
                            Analytics
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseAnalytics" aria-labelledby="headingTwo"
                            data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">

                                <a class="nav-link" href="{{ url_for('poanalytics') }}">Emission Trends</a>


                            </nav>
                        </div>

                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse"
                            data-bs-target="#collapseProcurement" aria-expanded="false"
                            aria-controls="collapseProcurement">
                            <div class="sb-nav-link-icon"><i class="fas fa-box"></i></div>
                            Consumption Report
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseProcurement" aria-labelledby="headingProcurement"
                            data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{{ url_for('food_consumption') }}">Food</a>
                                <a class="nav-link" href="{{ url_for('lpg_consumption') }}">LPG</a>
                            </nav>
                        </div>
                        <a class="nav-link" href="{{ url_for('po') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-book"></i></div>
                            User's Guide
                        </a>
                        <div class="logout-container">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link" href="{{ url_for('logout') }}">
                                        <i class="fas fa-power-off fa-fw"></i>&nbsp; Sign-out
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-4" style="background-color: rgb(235, 235, 237);">
                    <h2 class="fw-bold text-uppercase border-bottom border-3 pb-2 text-center fs-1 pt-5"
                        style="border-color: #2c3f54;">Food Consumption Report</h2>

                    <div class="table-container" style="padding:auto">
                        <div class="table-wrapper">
                            

                            <!-- Topnav Table (Filters & Download Button) -->
                            <div class="topnav-table d-flex align-items-center justify-content-between px-3 py-2"
                                style="padding-top: 20px !important;">
                                <!-- Filter Dropdown -->
                                <div class="dropdown">
                                    <button class="btn dropdown-toggle px-4 py-2" type="button" id="filterDropdown"
                                        data-bs-toggle="dropdown" aria-expanded="false" style="border-color: #2c3f54;">
                                        <i class="fas fa-filter"></i> Filter Options
                                    </button>
                                    <ul class="dropdown-menu p-2 shadow-lg rounded-3" aria-labelledby="filterDropdown">

                                        <!-- Year Filter -->
                                        <li class="dropdown-submenu">
                                            <a class="dropdown-item dropdown-toggle" href="#">Year</a>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item {% if not selected_year %}active{% endif %}"
                                                        href="{{ url_for('food_consumption', office=office) }}">All Years</a></li>
                                                {% for y in range(2025, 2013, -1) %}
                                                <li><a class="dropdown-item {% if selected_year == y|string %}active{% endif %}"
                                                        href="{{ url_for('food_consumption', year=y, office=office) }}">{{ y }}</a></li>
                                                {% endfor %}
                                            </ul>
                                        </li>
                                        <!-- Month -->
                                        <li class="dropdown-submenu">
                                            <a class="dropdown-item dropdown-toggle" href="#">Month</a>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item {% if month == '' %}active{% endif %}"
                                                        href="?month=">All Months</a></li>
                                                {% for m in ["January", "February", "March", "April", "May", "June",
                                                "July",
                                                "August", "September", "October", "November", "December"] %}
                                                <li><a class="dropdown-item {% if month == m %}active{% endif %}"
                                                        href="?month={{ m }}">{{ m }}</a></li>
                                                {% endfor %}
                                            </ul>
                                        </li>

                                        <!-- Office -->
                                        <li class="dropdown-submenu">
                                            <a class="dropdown-item dropdown-toggle" href="#">Office</a>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item {% if office == '' %}active{% endif %}" href="{{ url_for('food_consumption', year=request.args.get('year'), month=request.args.get('month')) }}">All Offices</a></li>
                                                {% for office_name in ['Auxillary Services', 'RGO', 'IAU', 'QAM', 'SDO', 'PDO', 'EA', 'ICT', 'CAS', 'CABE', 'CICS', 'CET', 'CTE', 'CE', 'CA', 'TAO', 'ORS', 'SFAO', 'GC', 'OLS', 'SOO', 'SD', 'OJT', 'NSTP', 'HRMO', 'RMO', 'PO', 'BO', 'CD', 'AO', 'PFMO', 'EMU', 'PSO', 'GSO', 'ESO', 'RO', 'OVCRDES', 'OVCDEA', 'OVCAA', 'OVCAF'] %}
                                                    <li>
                                                        <a class="dropdown-item {% if office == office_name %}active{% endif %}" 
                                                           href="{{ url_for('food_consumption', year=request.args.get('year'), month=request.args.get('month'), office=office_name) }}">
                                                            {{ office_name }}
                                                        </a>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            

                                <!-- Download Report Button -->
                                <div class="download-category row">
                                    <div class="dropdown  col-sm">
                                        <button class="btn dropdown-toggle px-4 py-2" type="button"
                                            id="downloadDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                                            style="border-color: #2c3f54;">
                                            <i class="fas fa-ellipsis-h"></i> Actions
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="downloadDropdown">
                                            <li><a class="dropdown-item" href="#"
                                                    onclick="openCalculatorModal(); return false;">
                                                    Calculate</a></li>
                                            <li><a class="dropdown-item" href="#"
                                                    onclick="printReport(); return false;">
                                                    Print Report</a></li>
                                        </ul>
                                    </div>
                                    <div class="dropdown col-sm">
                                        <button class="btn dropdown-toggle px-4 py-2" type="button"
                                            id="downloadDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                                            style="border-color: #2c3f54;">
                                            <i class="fas fa-download"></i> Downloads
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="downloadDropdown">
                                            <li><a class="dropdown-item" href="#"
                                                    onclick="downloadExcel(); return false;">
                                                     Excel</a></li>
                                            <li><a class="dropdown-item" href="#"
                                                    onclick="downloadCSV(); return false;">
                                                     CSV</a></li>
                                        </ul>
                                        
                                    </div>
                                    
                                </div>
                            </div>

                            <!-- ------------------------------------------------------------------------------------------------------ -->
                            <div class="table-container">
                                <div class="fade-overlay fade-left" id="fadeLeft"></div>
                                <div class="fade-overlay fade-right" id="fadeRight"></div>
                                <!-- ðŸš€ Left Arrow -->
                                <div class="scroll-arrow scroll-arrow-left" id="arrowLeft">
                                    &#9664; <!-- Unicode left arrow -->
                                </div>
                                <!-- ðŸš€ Right Arrow -->
                                <div class="scroll-arrow scroll-arrow-right" id="arrowRight">
                                    &#9654; <!-- Unicode right arrow -->
                                </div>
                                <div class="scrollable-content" id="scrollableContent">
                                    <div class="table-wrapper">
                                        <!-- food Report Table -->
                                        <table class="table" id="reportTable">
                                            <thead>
                                                <tr>
                                                    <th>Year</th>
                                                    <th>Month</th>
                                                    <th>Office</th>
                                                    <th>Food Type</th>
                                                    <th>Servings</th>
                                                    <th>GHG Emission (KG CO2e)</th>
                                                    <th>GHG Emission (T CO2e)</th>
                                                    <th>Actions</th>
                                                </tr>
                                                <tbody id="reportData">
                                                    <tbody>
                                                {% for record in food_data %}
                                                <tr id="row-{{ record['id'] }}">
                                                    <td>{{ record['YearTransaction'] }}</td>
                                                    <td>{{ record['Month'] }}</td>
                                                    <td>{{ record['Office'] }}</td>
                                                    <td>{{ record['TypeOfFoodServed'] }}</td>
                                                    <td>{{ record['QuantityOfServing'] }}</td>
                                                    <td>{{ record['GHGEmissionKGCO2e'] }}</td>
                                                    <td>{{ record['GHGEmissionTCO2e'] }}</td>
                                                    <td>
                                                        <button class="delete-btn"
                                                            onclick="deleteRecord('{{ record.id }}')">
                                                            <i class="fa-solid fa-trash"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <script>
                                const arrowLeft = document.getElementById("arrowLeft");
                                const arrowRight = document.getElementById("arrowRight");

                                function updateFadeVisibility() {
                                    const { scrollLeft, scrollWidth, clientWidth } = scrollableContent;

                                    const showLeft = scrollLeft > 0;
                                    const showRight = scrollLeft < scrollWidth - clientWidth - 1;

                                    // ðŸŒŸ Fade visibility
                                    fadeLeft.classList.toggle("visible", showLeft);
                                    fadeLeft.classList.toggle("hidden", !showLeft);
                                    fadeRight.classList.toggle("visible", showRight);
                                    fadeRight.classList.toggle("hidden", !showRight);

                                    // ðŸ¡„ðŸ¡† Arrow visibility (same condition as fades)
                                    arrowLeft.classList.toggle("visible", showLeft);
                                    arrowRight.classList.toggle("visible", showRight);
                                }

                                scrollableContent.addEventListener("scroll", updateFadeVisibility);
                                window.addEventListener("resize", updateFadeVisibility);
                                document.addEventListener("DOMContentLoaded", updateFadeVisibility);

                                document.addEventListener('DOMContentLoaded', function () {
                                    const thElements = document.querySelectorAll('.table thead th');

                                    thElements.forEach(th => {
                                        th.addEventListener('mouseenter', function () {
                                            const text = this.textContent.trim();
                                            if (this.offsetWidth < this.scrollWidth) { // Check if text is truncated
                                                const tooltip = document.createElement('div');
                                                tooltip.textContent = text;
                                                tooltip.classList.add('custom-tooltip');
                                                document.body.appendChild(tooltip);

                                                const rect = this.getBoundingClientRect();
                                                tooltip.style.left = rect.left + 'px';
                                                tooltip.style.top = rect.bottom + 5 + 'px'; // Position below the th
                                            }
                                        });

                                        th.addEventListener('mouseleave', function () {
                                            const tooltip = document.querySelector('.custom-tooltip');
                                            if (tooltip) {
                                                tooltip.remove();
                                            }
                                        });
                                    });
                                });
                            </script>
                            <!-- ------------------------------------------------------------------------------------------------------ -->
                        </div>
                        <!-- Pagination -->
                        <div style="z-index: 1; position: relative;"
                            class="pagination-container d-flex justify-content-between align-items-center">
                            <!-- Previous Button -->
                            <a class="btn btn-dark {% if current_page == 1 %}disabled{% endif %}"
                                href="{{ url_for('food_consumption', page=current_page - 1, campus=request.args.get('campus'), category=request.args.get('category'), month=request.args.get('month'), office=request.args.get('office'), year=request.args.get('year')) }}">
                                &lsaquo; Previous
                            </a>

                            <!-- Page Indicator -->
                            <span class="page-indicator text-dark">
                                Page {{ current_page }} of {{ total_pages }}
                            </span>

                            <!-- Next Button -->
                            <a class="btn btn-dark {% if current_page == total_pages %}disabled{% endif %}"
                                href="{{ url_for('food_consumption', page=current_page + 1, campus=request.args.get('campus'), category=request.args.get('category'), month=request.args.get('month'), office=request.args.get('office'), year=request.args.get('year')) }}">
                                Next &rsaquo;
                            </a>
                        </div>
                    </div>

                    <BR>
                    <!-- Modal -->
                    <div id="myModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <div class="container">
                                <div class="form-container">
                                    <h2 style="text-align: center; color: #333; margin-bottom: 20px;">Food Consumption COâ‚‚ Emission Calculator</h2>
                                    <form method="POST" action="{{ url_for('food_consumption') }}" id="co2Form">
                                        <div class="form-group">
                                            <label for="campus">Campus:</label>
                                            <select id="campus" name="campus" class="form-control">
                                                <option value="" {% if not session.get('campus') %}selected{% endif %}></option>
                                                <option value="Alangilan" {% if session.get('campus')=='Alangilan' %}selected{% endif %}>Alangilan</option>
                                                <option value="ARASOF-Nasugbu" {% if session.get('campus')=='ARASOF-Nasugbu' %}selected{% endif %}>ARASOF-Nasugbu</option>
                                                <option value="Balayan" {% if session.get('campus')=='Balayan' %}selected{% endif %}>Balayan</option>
                                                <option value="Central" {% if session.get('campus')=='Central' %}selected{% endif %}>Central</option>
                                                <option value="JPLPC-Malvar" {% if session.get('campus')=='JPLPC-Malvar' %}selected{% endif %}>JPLPC-Malvar</option>
                                                <option value="Lemery" {% if session.get('campus')=='Lemery' %}selected{% endif %}>Lemery</option>
                                                <option value="Lipa" {% if session.get('campus')=='Lipa' %}selected{% endif %}>Lipa</option>
                                                <option value="Lobo" {% if session.get('campus')=='Lobo' %}selected{% endif %}>Lobo</option>
                                                <option value="Mabini" {% if session.get('campus')=='Mabini' %}selected{% endif %}>Mabini</option>
                                                <option value="Pablo Borbon" {% if session.get('campus')=='Pablo Borbon' %}selected{% endif %}>Pablo Borbon</option>
                                                <option value="Rosario" {% if session.get('campus')=='Rosario' %}selected{% endif %}>Rosario</option>
                                                <option value="San Juan" {% if session.get('campus')=='San Juan' %}selected{% endif %}>San Juan</option>

                                            </select>
                                        </div>
                    
                                        <div class="form-group">
                                            <label for="year">Year:</label>
                                            <select id="year" name="year" required class="form-control">
                                                <option value="2025">2025</option>
                                                <option value="2024">2024</option>
                                                <option value="2023">2023</option>
                                                <option value="2022">2022</option>
                                                <option value="2021">2021</option>
                                                <option value="2020">2020</option>
                                            </select>
                                        </div>
                    
                                        <div class="form-group">
                                            <label for="month">Month:</label>
                                            <select id="month" name="month" required class="form-control">
                                                <option value=""></option>
                                                <option value="January">January</option>
                                                <option value="February">February</option>
                                                <option value="March">March</option>
                                                <option value="April">April</option>
                                                <option value="May">May</option>
                                                <option value="June">June</option>
                                                <option value="July">July</option>
                                                <option value="August">August</option>
                                                <option value="September">September</option>
                                                <option value="October">October</option>
                                                <option value="November">November</option>
                                                <option value="December">December</option>
                                            </select>
                                        </div>
                    
                                        <div class="form-group">
                                            <label for="office">Office:</label>
                                            <select id="office" name="office" required  class="form-control">
                                                <option value=""></option>
                                                <option value="Auxillary Services">Auxillary Services</option>
                                                <option value="RGO">RGO</option>
                                                <option value="IAU" {% if office=='IAU' %}selected{% endif %}>IAU</option>
                                                <option value="QAM" {% if office=='QAM' %}selected{% endif %}>QAM</option>
                                                <option value="SDO" {% if office=='SDO' %}selected{% endif %}>SDO</option>
                                                <option value="PDO" {% if office=='PDO' %}selected{% endif %}>PDO</option>
                                                <option value="EA" {% if office=='EA' %}selected{% endif %}>EA</option>
                                                <option value="ICT" {% if office=='ICT' %}selected{% endif %}>ICT</option>
                                                <option value="CAS" {% if office=='CAS' %}selected{% endif %}>CAS</option>
                                                <option value="CABE" {% if office=='CABE' %}selected{% endif %}>CABE</option>
                                                <option value="CICS" {% if office=='CICS' %}selected{% endif %}>CICS</option>
                                                <option value="CET" {% if office=='CET' %}selected{% endif %}>CET</option>
                                                <option value="CTE" {% if office=='CTE' %}selected{% endif %}>CTE</option>
                                                <option value="CE" {% if office=='CE' %}selected{% endif %}>CE</option>
                                                <option value="CA" {% if office=='CA' %}selected{% endif %}>CA</option>
                                                <option value="TAO" {% if office=='TAO' %}selected{% endif %}>TAO</option>
                                                <option value="ORS" {% if office=='ORS' %}selected{% endif %}>ORS</option>
                                                <option value="SFAO" {% if office=='SFAO' %}selected{% endif %}>SFAO</option>
                                                <option value="GC" {% if office=='GC' %}selected{% endif %}>GC</option>
                                                <option value="OLS" {% if office=='OLS' %}selected{% endif %}>OLS</option>
                                                <option value="SOO" {% if office=='SOO' %}selected{% endif %}>SOO</option>
                                                <option value="SD" {% if office=='SD' %}selected{% endif %}>SD</option>
                                                <option value="OJT" {% if office=='OJT' %}selected{% endif %}>OJT</option>
                                                <option value="NSTP" {% if office=='NSTP' %}selected{% endif %}>NSTP</option>
                                                <option value="HRMO" {% if office=='HRMO' %}selected{% endif %}>HRMO</option>
                                                <option value="RMO" {% if office=='RMO' %}selected{% endif %}>RMO</option>
                                                <option value="PO" {% if office=='PO' %}selected{% endif %}>PO</option>
                                                <option value="BO" {% if office=='BO' %}selected{% endif %}>BO</option>
                                                <option value="CD" {% if office=='CD' %}selected{% endif %}>CD</option>
                                                <option value="AO" {% if office=='AO' %}selected{% endif %}>AO</option>
                                                <option value="PFMO" {% if office=='PFMO' %}selected{% endif %}>PFMO</option>
                                                <option value="EMU" {% if office=='EMU' %}selected{% endif %}>EMU</option>
                                                <option value="PSO" {% if office=='PSO' %}selected{% endif %}>PSO</option>
                                                <option value="GSO" {% if office=='GSO' %}selected{% endif %}>GSO</option>
                                                <option value="ESO" {% if office=='ESO' %}selected{% endif %}>ESO</option>
                                                <option value="RO" {% if office=='RO' %}selected{% endif %}>RO</option>
                                                <option value="OVCRDES" {% if office=='OVCRDES' %}selected{% endif %}>OVCRDES</option>
                                                <option value="OVCDEA" {% if office=='OVCDEA' %}selected{% endif %}>OVCDEA</option>
                                                <option value="OVCAA" {% if office=='OVCAA' %}selected{% endif %}>OVCAA</option>
                                                <option value="OVCAF" {% if office=='OVCAF' %}selected{% endif %}>OVCAF</option>
                                            </select>
                                        </div>
                    
                                        <div class="form-group">
                                            <label for="foodType">Type of Food Served:</label>
                                            <select id="foodType" name="foodType" required class="form-control">
                                                <option value=""></option>
                                                <option value="1 Standard Breakfast">1 Standard Breakfast</option>
                                                <option value="1 Gourmet Breakfast">1 Gourmet Breakfast</option>
                                                <option value="1 Hot Snack (burger and fries)">1 Hot Snack (burger and fries)</option>
                                                <option value="1 Cold or Hot Snack">1 Cold or Hot Snack</option>
                                                <option value="1 Sandwich">1 Sandwich</option>
                                                <option value="1 Average Meal">1 Average Meal</option>
                                                <option value="Meal,Vegan">Meal,Vegan</option>
                                                <option value="Meal,Vegetarian">Meal,Vegetarian</option>
                                                <option value="Meal with Beef">Meal with Beef</option>
                                                <option value="Meal with Chicken">Meal with Chicken</option>
                                            </select>
                                        </div>
                    
                                        <div class="form-group">
                                            <label for="servings">No. of Servings:</label>
                                            <input type="number" id="servings" name="servings" step="0.01" required class="form-control">
                                        </div>
                    
                                        <div class="form-group">
                                            <button type="button" onclick="calculateCO2Emission()" class="btn-calculate">Calculate</button>
                                        </div>
                    
                                        <!-- GHG Emission fields that will be calculated -->
                                        <div class="ghg-emission-container">
                                            <div class="ghg-emission-field">
                                                <label for="ghgEmissionKg">GHG Emission (KG COâ‚‚e):</label>
                                                <input type="number" id="ghgEmissionKg" name="ghgEmissionKg" step="0.01" readonly class="form-control" value="0.00">
                                            </div>
                                            <div class="ghg-emission-field">
                                                <label for="ghgEmissionTons">GHG Emission (T COâ‚‚e):</label>
                                                <input type="number" id="ghgEmissionTons" name="ghgEmissionTons" step="0.01" readonly class="form-control" value="0.00">
                                            </div>
                                        </div>
                    
                                        <!-- Buttons to calculate and generate report -->
                                        <div class="form-group">
                                            <button type="button" onclick="generateReport()" class="btn-generate">Generate Report</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script>
                        document.getElementById("campus").addEventListener("mousedown", function (event) {event.preventDefault()});
                    </script>
                    
                    <style>
                        /* Modal backdrop with a blur effect */
                        .modal {
                            display: none;
                            position: fixed;
                            z-index: 5;
                            left: 0;
                            top: 0;
                            width: 100%;
                            height: 100%;
                            overflow: auto;
                            background-color: rgba(0, 0, 0, 0.7);
                            backdrop-filter: blur(10px); /* Adds a blur effect to the background */
                        }
                    
                        /* Modal content with glass morphism effect */
                        .modal-content {
                            background-color: rgb(222, 229, 239); /* Semi-transparent white */
                            margin: 5% auto;
                            padding: 30px;
                            border-radius: 15px;
                            width: 50%;
                            max-width: 600px;
                            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                            border: 1px solid rgba(255, 255, 255, 0.18); /* Subtle border for glass effect */
                            backdrop-filter: blur(10px); /* Enhances the glass morphism effect */
                            animation: slideIn 0.5s ease-out; /* Smooth slide-in animation */
                        }
                    
                        /* Keyframes for slide-in animation */
                        @keyframes slideIn {
                            from {
                                transform: translateY(-50px);
                                opacity: 0;
                            }
                            to {
                                transform: translateY(0);
                                opacity: 1;
                            }
                        }
                    
                        /* Close button with a modern look */
                        .close {
                            color: #aaa;
                            float: right;
                            font-size: 28px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: color 0.3s ease;
                        }
                    
                        .close:hover {
                            color: #ff4757; /* Vibrant red for hover */
                        }
                    
                        /* Form container styling */
                        .form-container {
                            max-width: 100%;
                            margin: 0 auto;
                        }
                    
                        /* Form group styling */
                        .form-group {
                            margin-bottom: 20px;
                        }
                    
                        /* Input and select fields with a modern look */
                        .form-control {
                            height: max-content;
                            width: 100%;
                            padding: 12px;
                            border: 1px solid rgba(0, 0, 0, 0.1);
                            border-radius: 8px;
                            font-size: 16px;
                            background-color: rgba(255, 255, 255, 0.9);
                            transition: border-color 0.3s ease, box-shadow 0.3s ease;
                        }
                    
                        .form-control:focus {
                            border-color: #007bff;
                            box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
                            outline: none;
                        }
                    
                        /* Buttons with gradient and hover effects */
                        .btn-calculate, .btn-generate {
                            width: 100%;
                            padding: 12px;
                            background: linear-gradient(135deg, #007bff, #00bfff); /* Gradient background */
                            color: #fff;
                            border: none;
                            border-radius: 8px;
                            font-size: 16px;
                            cursor: pointer;
                            transition: background 0.3s ease, transform 0.2s ease;
                        }
                    
                        .btn-calculate:hover, .btn-generate:hover {
                            background: linear-gradient(135deg, #0056b3, #0099cc); /* Darker gradient on hover */
                            transform: translateY(-2px); /* Slight lift effect */
                        }
                    
                        /* GHG emission container with a futuristic card look */
                        .ghg-emission-container {
                            background: rgba(249, 249, 249, 0.9);
                            padding: 20px;
                            border-radius: 12px;
                            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
                            margin-bottom: 20px;
                        }
                    
                        /* GHG emission fields with a clean layout */
                        .ghg-emission-field {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 15px;
                        }
                    
                        .ghg-emission-field label {
                            font-weight: bold;
                            color: #333;
                        }
                    
                        .ghg-emission-field input {
                            border: none;
                            background: transparent;
                            color: #555;
                            text-align: right;
                            width: 100px;
                            font-size: 16px;
                        }
                    
                        /* Responsive adjustments */
                        @media (max-width: 768px) {
                            .modal-content {
                                width: 90%;
                                padding: 20px;
                            }
                        }
                    </style>
                    
                </div>
            </main>
        </div>
    </div>


    <script>
        // Emission factors based on food type
        const foodFactors = {
            "1 Standard Breakfast": 0.84,
            "1 Gourmet Breakfast": 2.33,
            "1 Hot Snack (burger and fries)": 2.77,
            "1 Cold or Hot Snack": 2.02,
            "1 Sandwich": 1.27,
            "1 Average Meal": 4.70,
            "Meal,Vegan": 1.69,
            "Meal,Vegetarian": 2.85,
            "Meal with Beef": 6.93,
            "Meal with Chicken": 3.39
        };

        // Function to calculate CO2 emissions
        function calculateCO2Emission() {
            const foodType = document.getElementById('foodType').value;
            const servings = parseFloat(document.getElementById('servings').value) || 0;

            const factor = foodFactors[foodType] || 0;
            const ghgEmissionKgCO2e = servings * factor;
            const ghgEmissionTCO2e = ghgEmissionKgCO2e / 1000;

            document.getElementById('ghgEmissionKg').value = ghgEmissionKgCO2e.toFixed(2);
            document.getElementById('ghgEmissionTons').value = ghgEmissionTCO2e.toFixed(2);
        }

        // Function to submit the form and close the modal
        function generateReport() {
            document.getElementById("co2Form").submit();
            closeModal();
        }

        // Functions to open and close the modal
        function openCalculatorModal() {
            document.getElementById('myModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('myModal').style.display = 'none';
        }

        // Function to filter food consumption data based on selected filters
        function filterFoodReport() {
            // Get filter values from the dropdowns
            const monthElement = document.getElementById('monthFilter');
            const officeElement = document.getElementById('officeFilter');
            const yearElement = document.getElementById('yearFilter');

            const month = monthElement ? monthElement.value : null;
            const office = officeElement ? officeElement.value : null;
            const year = yearElement ? yearElement.value : null;

            // Build the query string based on selected filters
            let queryString = [];
            if (month) queryString.push(`month=${encodeURIComponent(month)}`);
            if (office) queryString.push(`office=${encodeURIComponent(office)}`);
            if (year) queryString.push(`year=${encodeURIComponent(year)}`);
            queryString = queryString.length > 0 ? '?' + queryString.join('&') : '';

            // Fetch filtered data from the server
            fetch(`/food_consumption/all${queryString}`)
                .then(response => response.json())
                .then(data => {
                    // Clear the existing table body
                    const tableBody = document.getElementById('reportData');
                    tableBody.innerHTML = '';

                    // Populate the table with the filtered data
                    if (data.length > 0) {
                        data.forEach(report => {
                            const row = `
                        <tr>
                            <td>${report.Campus}</td>
                            <td>${report.YearTransaction}</td>
                            <td>${report.Month}</td>
                            <td>${report.Office}</td>
                            <td>${report.TypeOfFoodServed}</td>
                            <td>${report.QuantityOfServing}</td>
                            <td>${report.GHGEmissionKGCO2e}</td>
                            <td>${report.GHGEmissionTCO2e}</td>
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="deleteRecord(${report.id})">
                                    <i class="fas fa-trash-alt"></i> Delete
                                </button>
                            </td>
                        </tr> `;
                            tableBody.insertAdjacentHTML('beforeend', row);
                        });
                    } else {
                        // If no data is returned, show a message
                        const noDataRow = `
                        <tr>
                            <td colspan="9" style="text-align: center;">No data available for the selected filters.</td>
                        </tr>
                        `;
                        tableBody.insertAdjacentHTML('beforeend', noDataRow);
                    }
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // Attach the filter function to the change event of the filter dropdowns
        document.getElementById('yearFilter').addEventListener('change', filterFoodReport);
        document.getElementById('monthFilter').addEventListener('change', filterFoodReport);
        document.getElementById('officeFilter').addEventListener('change', filterFoodReport);


        // Function to print the report with filtered data if filters are applied, otherwise all data
        function printFoodReport() {
            // Check if the elements exist before accessing their values
            const monthElement = document.getElementById('monthFilter');
            const officeElement = document.getElementById('officeFilter');
            const yearElement = document.getElementById('yearFilter');

            const month = monthElement ? monthElement.value : null;
            const office = officeElement ? officeElement.value : null;
            const year = yearElement ? yearElement.value : null;

            // Build the query string based on selected filters
            let queryString = '';
            if (month) queryString += `month=${month}&`;
            if (office) queryString += `office=${office}&`;
            if (year) queryString += `year=${year}`;

            // Fetch data from the server, either filtered or all
            fetch(`/food_consumption/all?${queryString}`)
                .then(response => response.json())
                .then(data => {
                    // Generate the table header
                    const tableHeader = `
                        <thead>
                            <tr>
                            <th>Campus</th>
                                <th>Year</th>
                                <th>Month</th>
                                <th>Office</th>
                                <th>Food Type</th>
                                <th>Servings</th>
                                <th>GHG Emission (KG CO2e)</th>
                                <th>GHG Emission (T CO2e)</th>
                            </tr>
                        </thead>`;

                    // Generate table rows with the fetched data
                    const tableBody = data.map(report => `
                        <tr>
                            <td>${report.Campus}</td>
                            <td>${report.YearTransaction}</td>
                            <td>${report.Month}</td>
                            <td>${report.Office}</td>
                            <td>${report.TypeOfFoodServed}</td>
                            <td>${report.QuantityOfServing}</td>
                            <td>${report.GHGEmissionKGCO2e}</td>
                            <td>${report.GHGEmissionTCO2e}</td>
                        </tr>
                    `).join('');

                    // Create the print layout
                    const printContents = `
                         <div class="header">
                            <img src="${window.location.origin}/static/images/bsu.png" alt="BSU Logo" style="width: 50px; height: auto;">
                            <h2>Food Consumption Report</h2>
                            <img src="${window.location.origin}/static/images/csd.png" alt="CSD Logo" style="width: 50px; height: auto;">
                        </div>
                        <table border="1" cellspacing="0" cellpadding="5" style="width: 100%; border-collapse: collapse;">
                            ${tableHeader}
                            <tbody>
                                ${tableBody}
                            </tbody>
                        </table>
                    `;

                    // Save original document content
                    const originalContents = document.body.innerHTML;

                    // Replace document body with print content
                    document.body.innerHTML = printContents;

                    // Print the new content
                    window.print();

                    // Restore original document content
                    document.body.innerHTML = originalContents;
                })
                .catch(error => console.error('Error fetching data:', error));
        }




        // Function to export the food consumption table to Excel
        function downloadExcel() {
            try {
                // Get current filters from URL
                const filters = getCurrentFilters();
                const queryString = buildFilterQueryString(filters);

                // Fetch filtered data
                fetch(`/food_consumption/all${queryString}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (!data || data.length === 0) {
                            alert('No data available to export.');
                            return;
                        }

                        // Prepare the data for Excel
                        const excelData = data.map(record => ({
                            'Year': record.YearTransaction || '',
                            'Month': record.Month || '',
                            'Office': record.Office || '',
                            'Food Type': record.TypeOfFoodServed || '',
                            'Servings': record.QuantityOfServing || '',
                            'GHG Emission (KG CO2e)': record.GHGEmissionKGCO2e || '',
                            'GHG Emission (T CO2e)': record.GHGEmissionTCO2e || ''
                        }));

                        // Convert to worksheet
                        const ws = XLSX.utils.json_to_sheet(excelData);

                        // Create workbook and add the worksheet
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, 'Food Consumption');

                        // Save the file with filters in filename
                        const filename = `FoodConsumptionReport${filters.year ? '_' + filters.year : ''}${filters.month ? '_' + filters.month : ''}${filters.office ? '_' + filters.office : ''}.xlsx`;
                        XLSX.writeFile(wb, filename);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while generating the Excel file.');
                    });
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while preparing the Excel download.');
            }
        }

        function deleteRecord(recordId) {
            if (confirm("Are you sure you want to delete this record?")) {
                fetch(`/delete_food_record/${recordId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Remove the row from the table if the deletion was successful
                            const row = document.getElementById(`row-${recordId}`);
                            if (row) row.remove();
                            alert("Record deleted successfully.");
                        } else {
                            alert("Error deleting record: " + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Delete error:', error);
                        alert("An error occurred while deleting the record.");
                    });
            }
        }
        function downloadCSV() {
            // Get current filters from URL
            const filters = getCurrentFilters();
            const queryString = buildFilterQueryString(filters);

            // Fetch filtered data
            fetch(`/food_consumption/all${queryString}`)
                .then(response => response.json())
                .then(data => {
                    if (!data || data.length === 0) {
                        alert('No data available to export.');
                        return;
                    }

                    // Define headers
                    const headers = [
                        'Year',
                        'Month',
                        'Office',
                        'Food Type',
                        'Servings',
                        'GHG Emission (KG CO2e)',
                        'GHG Emission (T CO2e)'
                    ];

                    // Prepare rows
                    const rows = data.map(record => [
                        record.YearTransaction || '',
                        record.Month || '',
                        record.Office || '',
                        record.TypeOfFoodServed || '',
                        record.QuantityOfServing || '',
                        record.GHGEmissionKGCO2e || '',
                        record.GHGEmissionTCO2e || ''
                    ]);

                    // Create CSV content
                    const csvContent = [
                        headers.join(','),
                        ...rows.map(row => row.map(cell => `"${cell || ''}"`).join(','))
                    ].join('\n');

                    // Create and trigger download
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    const filename = `FoodConsumptionReport${filters.year ? '_' + filters.year : ''}${filters.month ? '_' + filters.month : ''}${filters.office ? '_' + filters.office : ''}.csv`;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                })
                .catch(error => {
                    console.error('Error exporting data:', error);
                    alert('An error occurred while exporting the data.');
                });
        }
        

        function printReport() {
            // Get current filters from URL
            const filters = getCurrentFilters();
            const queryString = buildFilterQueryString(filters);

            // Fetch filtered data from the server
            fetch(`/food_consumption/all${queryString}`)
                .then(response => response.json())
                .then(data => {
                    if (!data || data.length === 0) {
                        alert('No data available to print.');
                        return;
                    }

                    // Create print content with filter information
                    const printContent = `
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h2>Food Consumption Report</h2>
                            ${filters.year ? `<p>Year: ${filters.year}</p>` : ''}
                            ${filters.month ? `<p>Month: ${filters.month}</p>` : ''}
                            ${filters.office ? `<p>Office: ${filters.office}</p>` : ''}
                        </div>
                        <table border="1" style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Month</th>
                                    <th>Office</th>
                                    <th>Food Type</th>
                                    <th>Servings</th>
                                    <th>GHG Emission (KG CO2e)</th>
                                    <th>GHG Emission (T CO2e)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(record => `
                                    <tr>
                                        <td>${record.YearTransaction || ''}</td>
                                        <td>${record.Month || ''}</td>
                                        <td>${record.Office || ''}</td>
                                        <td>${record.TypeOfFoodServed || ''}</td>
                                        <td>${record.QuantityOfServing || ''}</td>
                                        <td>${record.GHGEmissionKGCO2e || ''}</td>
                                        <td>${record.GHGEmissionTCO2e || ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>`;

                    // Store current page content
                    const originalContent = document.body.innerHTML;
                    
                    // Replace with print content
                    document.body.innerHTML = printContent;
                    
                    // Print
                    window.print();
                    
                    // Restore original content
                    document.body.innerHTML = originalContent;
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert('An error occurred while preparing the print.');
                });
        }

        function getCurrentFilters() {
        const urlParams = new URLSearchParams(window.location.search);
        return {
            year: urlParams.get('year'),
            month: urlParams.get('month'),
            office: urlParams.get('office'),
            campus: urlParams.get('campus')
        };
    }

    function buildFilterQueryString(filters) {
        const queryParts = [];
        if (filters.year) queryParts.push(`year=${encodeURIComponent(filters.year)}`);
        if (filters.month) queryParts.push(`month=${encodeURIComponent(filters.month)}`);
        if (filters.office) queryParts.push(`office=${encodeURIComponent(filters.office)}`);
        if (filters.campus) queryParts.push(`campus=${encodeURIComponent(filters.campus)}`);
        return queryParts.length > 0 ? '?' + queryParts.join('&') : '';
    }
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let currentPath = window.location.pathname;
            let sidebarLinks = document.querySelectorAll(".nav-link");

            sidebarLinks.forEach(link => {
                if (link.getAttribute("href") === currentPath) {
                    link.classList.add("active");

                    // If the link is inside a dropdown, open the dropdown
                    let parentCollapse = link.closest(".collapse");
                    if (parentCollapse) {
                        parentCollapse.classList.add("show");
                        let dropdownToggle = document.querySelector(`[data-bs-target="#${parentCollapse.id}"]`);
                        if (dropdownToggle) {
                            dropdownToggle.classList.add("active");
                        }
                    }
                }
            });
        });
    </script>


</body>

</html>