<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDO Report</title>
    <link rel="icon" href="{{ url_for('static', filename='images/sdo.jpg') }}" type="image/x-icon">
    <!-- âœ… Bootstrap 4 CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- âœ… Font Awesome (For Icons) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/reports.css') }}" rel="stylesheet">
    <!-- âœ… Custom CSS -->
    <link href="{{ url_for('static', filename='css/emucss.css') }}" rel="stylesheet">
    <!-- âœ… jQuery (MUST be first, before Bootstrap) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- âœ… Popper.js (Required for Bootstrap dropdowns) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <!-- âœ… Bootstrap 4 JS (Only one version) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- âœ… PDF & HTML to PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</head>

<body class="sb-nav-fixed">
    <!-- Navbar at the top -->
    {% include 'sdotopnav.html' %}
    <a class="navbar-brand ps-3" href="#">SDO <span style="text-transform: uppercase; font-style: italic;">{{
            session['campus'] }} REPORT</span></a>
    <div class="ms-auto"></div>
    <!--<ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('logout') }}">
                    <i class="fas fa-power-off fa-fw"></i> Sign-out
                </a>
            </li>
        </ul>-->
    </nav>

    <!-- Sidebar and Main Content Layout -->
    <div id="layoutSidenav">
        <!-- Sidebar -->
        {% include 'sidebar.html' %}

        <!--body content-->
        <div id="layoutSidenav_content" style="margin: 0 auto;">
            <!--tabe content-->
            <div class="container-fluid px-4">
                <h3 class="fw-bold text-uppercase border-bottom border-3 pb-2 text-center fs-1 pt-5"
                    style="border-color: #2b3e53;">
                    Accommodation Emissions Report
                </h3>
                <div class="table-wrapper">

                    <div class="topnav-table d-flex align-items-center justify-content-between px-3 py-2">
                        <!-- Dropdown category -->
                        <div class="dropdown" style="margin-top: 20px;">
                            <button class="btn dropdown-toggle px-4 py-2 m-3" type="button" id="filterDropdown"
                                data-bs-toggle="dropdown" aria-expanded="false" style="border-color: #2b3e53;">
                                <i class="fas fa-filter"></i> Filter Options
                            </button>
                            <ul class="dropdown-menu p-2 shadow-lg rounded-3" aria-labelledby="filterDropdown">
                                <!-- Office -->
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">Office</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item {% if request.args.get('office') == '' %}active{% endif %}"
                                                href="?office=">All Offices</a></li>
                                        {% for office in ["IAU", "QAM", "SDO", "PDO", "EA", "RGO", "ICT",
                                        "CAS", "CABE",
                                        "CICS", "CET", "CTE", "CE", "CA", "TAO", "ORS", "SFAO", "GC",
                                        "OLS", "SOO", "SD", "OJT", "NSTP", "HRMO", "RMO", "PO", "BO",
                                        "CD", "AO", "PFMO", "EMU", "PSO", "GSO", "ESO", "RO", "OVCRDES",
                                        "OVCDEA", "OVCAA", "OVCAF"] %}
                                        <li><a class="dropdown-item {% if request.args.get('office') == office %}active{% endif %}"
                                                href="?office={{ office }}">{{ office }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                                <!-- Year -->
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">Year</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item {% if request.args.get('year') == '' %}active{% endif %}"
                                                href="?year=">All Years</a></li>
                                        {% for y in range(2025, 2013, -1) %}
                                        <li><a class="dropdown-item {% if request.args.get('year') == y|string %}active{% endif %}"
                                                href="?year={{ y }}">{{ y }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <!-- Download Report Button -->
                        <div class="download-category">
                            <button class="btn dropdown-toggle px-4 py-2" type="button" id="downloadDropdown"
                                data-bs-toggle="dropdown" aria-expanded="false" style="border-color: #2b3e53;">
                                <i class="fas fa-download"></i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="downloadDropdown">
                                <li><a class="dropdown-item"
                                        href="{{ url_for('sdo_accommodation_emissions_pdf', campus=request.args.get('campus'), office=request.args.get('office'), year=request.args.get('year')) }}">
                                        Download PDF</a></li>
                                <li><a class="dropdown-item"
                                        href="{{ url_for('sdo_accommodation_emissions_excel', campus=request.args.get('campus'), office=request.args.get('office'), year=request.args.get('year')) }}">
                                        Download Excel</a></li>
                                <li><a class="dropdown-item"
                                        href="{{ url_for('export_accommodation_emissions_csv', campus=request.args.get('campus'), office=request.args.get('office'), year=request.args.get('year')) }}">
                                        Download CSV</a></li>
                            </ul>
                        </div>
                    </div>

                </div>


                <div class="table-container">
                    <div class="fade-overlay fade-left" id="fadeLeft"></div>
                    <div class="fade-overlay fade-right" id="fadeRight"></div>
                    <!-- ðŸš€ Left Arrow -->
                    <div class="scroll-arrow scroll-arrow-left" id="arrowLeft">
                        &#9664; <!-- Unicode left arrow -->
                    </div>

                    <!-- ðŸš€ Right Arrow -->
                    <div class="scroll-arrow scroll-arrow-right" id="arrowRight">
                        &#9654; <!-- Unicode right arrow -->
                    </div>

                    <div class="scrollable-content" id="scrollableContent">
                        <!-- Accommodation Emissions Table -->
                        <table class="table" id="accommodation_data">
                            <thead>
                                <tr>
                                    <th>Campus</th>
                                    <th>Office</th>
                                    <th>Year</th>
                                    <th>Traveller</th>
                                    <th>Event Name</th>
                                    <th>Travel Date From</th>
                                    <th>Travel Date To</th>
                                    <th>Country</th>
                                    <th>Local/International</th>
                                    <th>Occupied Rooms</th>
                                    <th>Nights per Room</th>
                                    <th>kg COâ‚‚e</th>
                                    <th>t COâ‚‚e</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="accommodation_data">
                                {% if data %}
                                {% for accommodation in data %}
                                <tr>
                                    <td>{{ accommodation['Campus'] }}</td>
                                    <td>{{ accommodation['Office'] }}</td>
                                    <td>{{ accommodation['YearTransact'] }}</td>
                                    <td>{{ accommodation['TravellerName'] }}</td>
                                    <td>{{ accommodation['TravelPurpose'] }}</td>
                                    <td>{{ accommodation['TravelDateFrom'] }}</td>
                                    <td>{{ accommodation['TravelDateTo'] }}</td>
                                    <td>{{ accommodation['Country'] }}</td>
                                    <td>{{ accommodation['TravelType'] }}</td>
                                    <td>{{ accommodation['NumOccupiedRoom'] }}</td>
                                    <td>{{ accommodation['NumNightPerRoom'] }}</td>
                                    <td>{{ accommodation['GHGEmissionKGC02e'] }}</td>
                                    <td>{{ accommodation['GHGEmissionTC02e'] }}</td>
                                    <td>
                                        <div class="d-flex justify-content-center gap-2">
                                            <!-- Edit Button -->
                                            <button type="button" class="btn btn-primary btn-sm" 
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#editModal{{ accommodation['id'] }}"
                                                    style="background-color: transparent; border: none;">
                                                <i class="fas fa-edit" style="color: #0d6efd;"></i>
                                            </button>
                                            
                                            <!-- Delete Button -->
                                            <form class="delete-form d-inline" data-id="{{ accommodation['id'] }}">
                                                <button type="submit" class="btn btn-sm" 
                                                        style="background-color: transparent; border: none;">
                                                    <i class="fas fa-trash" style="color: #dc3545;"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                <style>
                                    .btn-sm i {
                                        font-size: 1rem;
                                    }
                                    
                                    .btn-sm:hover {
                                        opacity: 0.8;
                                    }
                                    
                                    .d-flex.gap-2 {
                                        gap: 0.5rem !important;
                                    }
                                    
                                    /* Remove button outline on focus */
                                    .btn:focus {
                                        box-shadow: none !important;
                                    }
                                </style>
                                <!-- Edit Modal -->
                                <div class="modal fade" id="editModal{{ accommodation['id'] }}" tabindex="-1">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h2 class="modal-title">Edit Accommodation Record</h2>
                                                <button type="button" class="btn-close"
                                                    data-bs-dismiss="modal"></button>
                                            </div>
                                            <div class="modal-body">
                                                <form
                                                    action="{{ url_for('edit_accommodation_record', id=accommodation['id']) }}"
                                                    method="POST">
                                                    <!-- Campus (readonly) -->
                                                    <div class="form-group">
                                                        <label for="campus">Campus:</label>
                                                        <input type="text" id="campus" name="campus"
                                                            class="form-control" value="{{ accommodation['Campus'] }}"
                                                            readonly>
                                                    </div>

                                                    <!-- Office -->
                                                    <div class="form-group">
                                                        <label for="office">Office:</label>
                                                        <select id="office" name="office" required class="form-control">
                                                            {% for office in ["IAU", "QAM", "SDO", "PDO", "EA", "RGO",
                                                            "ICT",
                                                            "CAS", "CABE",
                                                            "CICS", "CET", "CTE", "CE", "CA", "TAO", "ORS", "SFAO",
                                                            "GC",
                                                            "OLS", "SOO", "SD", "OJT", "NSTP", "HRMO", "RMO", "PO",
                                                            "BO",
                                                            "CD", "AO", "PFMO", "EMU", "PSO", "GSO", "ESO", "RO",
                                                            "OVCRDES",
                                                            "OVCDEA", "OVCAA", "OVCAF"] %}
                                                            <option value="{{ office }}" {% if
                                                                accommodation['Office']==office %}selected{% endif %}>
                                                                {{ office }}
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>

                                                    <!-- Year -->
                                                    <div class="form-group">
                                                        <label for="year">Year:</label>
                                                        <select id="year" name="year" required class="form-control">
                                                            {% for y in range(2025, 2013, -1) %}
                                                            <option value="{{ y }}" {% if
                                                                accommodation['YearTransact']==y %}selected{% endif %}>
                                                                {{ y }}
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>

                                                    <!-- Traveller Name -->
                                                    <div class="form-group">
                                                        <label for="travellerName">Traveller Name:</label>
                                                        <input type="text" id="travellerName" name="travellerName"
                                                            required class="form-control"
                                                            value="{{ accommodation['TravellerName'] }}">
                                                    </div>

                                                    <!-- Event Name -->
                                                    <div class="form-group">
                                                        <label for="eventName">Event Name:</label>
                                                        <input type="text" id="eventName" name="eventName" required
                                                            class="form-control"
                                                            value="{{ accommodation['TravelPurpose'] }}">
                                                    </div>

                                                    <!-- Travel Dates -->
                                                    <div class="form-group">
                                                        <label for="travelDateFrom">Travel Date From:</label>
                                                        <input type="date" id="travelDateFrom" name="travelDateFrom"
                                                            required class="form-control"
                                                            value="{{ accommodation['TravelDateFrom'] }}">
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="travelDateTo">Travel Date To:</label>
                                                        <input type="date" id="travelDateTo" name="travelDateTo"
                                                            required class="form-control"
                                                            value="{{ accommodation['TravelDateTo'] }}">
                                                    </div>

                                                    <!-- Country dropdown in edit modal -->
                                                    <div class="form-group">
                                                        <label for="country">Country:</label>
                                                        <select id="country" name="country" required
                                                            class="form-control"
                                                            onchange="calculateAccommodationEmissions({{ accommodation['id'] }})">
                                                            <option value="">Select a country</option>
                                                            {% set countries = [
                                                            "Philippines", "Australia", "Argentina", "Armenia", "Aruba",
                                                            "Bahamas",
                                                            "Austria", "Bahrain", "Bangladesh", "Belarus", "Barbados",
                                                            "Belgium",
                                                            "Belize", "Benin", "Bermuda", "Bhutan", "Bolivia",
                                                            "Bosnia and Herzegovina", "Botswana", "Brazil",
                                                            "British Indian Ocean Territory", "British Virgin Islands",
                                                            "Brunei",
                                                            "Bulgaria", "Burkina Faso", "Burundi", "Cambodia",
                                                            "Cameroon",
                                                            "Canada", "Cape Verde", "Cayman Islands", "Central African
                                                            Republic",
                                                            "Chad", "Chile", "China", "Christmas Island", "Cocos
                                                            Islands",
                                                            "Colombia", "Comoros", "Cook Islands", "Costa Rica",
                                                            "Croatia",
                                                            "Cuba", "Curacao", "Cyprus", "Czech Republic",
                                                            "Democratic Republic of the Congo", "Denmark", "Djibouti",
                                                            "Dominica",
                                                            "East Timor", "Ecuador", "Egypt", "El Salvador", "Equatorial
                                                            Guinea",
                                                            "Eritrea", "Estonia", "Ethiopia", "Falkland Islands", "Faroe
                                                            Islands",
                                                            "Fiji", "Finland", "France", "French Polynesia", "Gabon",
                                                            "Gambia",
                                                            "Georgia", "Germany", "Ghana", "Gibraltar", "Greece",
                                                            "Greenland",
                                                            "Grenada", "Guam", "Guernsey", "Guinea", "Guyana",
                                                            "Guinea-Bissau",
                                                            "Haiti", "Honduras", "Hong Kong", "Hungary", "Iceland",
                                                            "India",
                                                            "Indonesia", "Iran", "Iraq", "Ireland", "Isle of Man",
                                                            "Israel",
                                                            "Italy", "Ivory Coast", "Jamaica", "Japan", "Jersey",
                                                            "Jordan",
                                                            "Kazakhstan", "Kenya", "Kiribati", "Kosovo", "Kuwait",
                                                            "Kyrgyzstan",
                                                            "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya",
                                                            "Liechtenstein", "Lithuania", "Luxembourg", "Macau",
                                                            "Macedonia",
                                                            "Madagascar", "Malaysia", "Maldives", "Mali", "Malta",
                                                            "Marshall Island", "Mauritania", "Mauritius", "Mayotte",
                                                            "Mexico",
                                                            "Micronesia", "Moldova", "Monaco", "Montenegro", "Mongolia",
                                                            "Montserrat", "Morocco", "Mozambique", "Myanmar", "Namibia",
                                                            "Nauru",
                                                            "Nepal", "Netherlands", "New Caledonia", "Netherlands
                                                            Antilles",
                                                            "New Zealand", "Nicaragua", "Niger", "Niue", "Nigeria",
                                                            "North Korea",
                                                            "Northern Mariana Islands", "Norway", "Oman", "Pakistan",
                                                            "Palau",
                                                            "Palestine", "Panama", "Papua New Guinea", "Paraguay",
                                                            "Peru",
                                                            "Pitcairn", "Poland", "Portugal", "Qatar", "Republic of the
                                                            Congo",
                                                            "Reunion", "Romania", "Russia", "Rwanda", "Saint
                                                            Barthelemy",
                                                            "Saint Helena", "Saint Kitts and Nevis", "Saint Lucia",
                                                            "Saint Martin",
                                                            "Saint Pierre and Miquelon", "Saint Vincent and the
                                                            Grenadines",
                                                            "Samoa", "San Marino", "Sao Tome and Principe", "Saudi
                                                            Arabia",
                                                            "Senegal", "Serbia", "Seychelles", "Sierra Leone",
                                                            "Singapore",
                                                            "Sint Maarten", "Slovakia", "Slovenia", "Solomon Islands",
                                                            "Somalia",
                                                            "South Africa", "South Korea", "South Sudan", "Spain", "Sri
                                                            Lanka",
                                                            "Sudan", "Suriname", "Svalbard and Jan Mayen", "Swaziland",
                                                            "Sweden",
                                                            "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania",
                                                            "Thailand",
                                                            "Togo", "Tokelau", "Tonga", "Trinidad and Tobago",
                                                            "Tunisia",
                                                            "Turkey", "Turkmenistan", "Turks and Caicos Islands",
                                                            "Tuvalu",
                                                            "U.S. Virgin Islands", "Uganda", "Ukraine", "United Arab
                                                            Emirates",
                                                            "United Kingdom", "United States", "Uruguay", "Uzbekistan",
                                                            "Vanuatu",
                                                            "Vatican", "Venezuela", "Vietnam", "Wallis and Futuna",
                                                            "Western Sahara", "Yemen", "Zambia", "Zimbabwe"
                                                            ] %}
                                                            {% for country in countries %}
                                                            <option value="{{ country }}" {% if
                                                                accommodation['Country']==country %}selected{% endif %}>
                                                                {{ country }}
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>

                                                    <!-- Travel Type -->
                                                    <div class="form-group">
                                                        <label for="localOrInternational">Local/International:</label>
                                                        <select id="localOrInternational" name="localOrInternational"
                                                            required class="form-control"
                                                            onchange="calculateAccommodationEmissions({{ accommodation['id'] }})">
                                                            <option value="Local" {% if
                                                                accommodation['TravelType']=='Local' %}selected{% endif
                                                                %}>
                                                                Local
                                                            </option>
                                                            <option value="International" {% if
                                                                accommodation['TravelType']=='International'
                                                                %}selected{% endif %}>
                                                                International
                                                            </option>
                                                        </select>
                                                    </div>

                                                    <!-- Rooms and Nights -->
                                                    <div class="form-group">
                                                        <label for="occupiedRooms">Number of Occupied Rooms:</label>
                                                        <input type="number" id="occupiedRooms" name="occupiedRooms"
                                                            required class="form-control"
                                                            value="{{ accommodation['NumOccupiedRoom'] }}"
                                                            onchange="calculateAccommodationEmissions({{ accommodation['id'] }})">
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="nightsPerRoom">Number of Nights per Room:</label>
                                                        <input type="number" id="nightsPerRoom" name="nightsPerRoom"
                                                            required class="form-control"
                                                            value="{{ accommodation['NumNightPerRoom'] }}"
                                                            onchange="calculateAccommodationEmissions({{ accommodation['id'] }})">
                                                    </div>

                                                    <!-- Emissions -->
                                                    <div class="ghg-emission-container">
                                                        <div class="ghg-emission-field">
                                                            <label>GHG Emission (KG COâ‚‚e):</label>
                                                            <input type="number" id="ghgEmissionKGC02e"
                                                                name="ghgEmissionKGC02e" readonly class="form-control"
                                                                value="{{ accommodation['GHGEmissionKGC02e'] }}">
                                                        </div>
                                                        <div class="ghg-emission-field">
                                                            <label>GHG Emission (T COâ‚‚e):</label>
                                                            <input type="number" id="ghgEmissionTC02e"
                                                                name="ghgEmissionTC02e" readonly class="form-control"
                                                                value="{{ accommodation['GHGEmissionTC02e'] }}">
                                                        </div>
                                                    </div>

                                                    <div class="form-group mt-4">
                                                        <button type="submit" class="btn btn-primary">Save
                                                            Changes</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="13" class="text-center">No data available</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>

                    </div>
                    <!-- Pagination -->
                    <div style="z-index: 4; position: relative; padding: 5px 10px; padding-top: 20px;"
                        class="pagination-container d-flex justify-content-between align-items-center">
                        <!-- Previous Button -->
                        <a class="btn btn-link text-dark {% if current_page == 1 %}disabled{% endif %}"
                            href="{{ url_for('sdo_accommodation_emissions_report', page=current_page-1, campus=campus_filter, office=office_filter, year=year_filter) }}">
                            &lsaquo; Previous
                        </a>

                        <!-- Page Indicator -->
                        <span class="page-indicator text-dark">
                            {{ current_page }} of {{ total_pages }}
                        </span>

                        <!-- Next Button -->
                        <a class="btn btn-dark {% if current_page == total_pages %}disabled{% endif %}"
                            href="{{ url_for('sdo_accommodation_emissions_report', page=current_page+1, campus=campus_filter, office=office_filter, year=year_filter) }}">
                            Next &rsaquo;
                        </a>
                    </div>
                </div>
            </div>



            <script>
                function updateFadeVisibility() {
                    const { scrollLeft, scrollWidth, clientWidth } = scrollableContent;

                    const showLeft = scrollLeft > 0;
                    const showRight = scrollLeft < scrollWidth - clientWidth - 1;

                    // ðŸŒŸ Fade visibility
                    fadeLeft.classList.toggle("visible", showLeft);
                    fadeLeft.classList.toggle("hidden", !showLeft);
                    fadeRight.classList.toggle("visible", showRight);
                    fadeRight.classList.toggle("hidden", !showRight);

                    // ðŸ¡„ðŸ¡† Arrow visibility (same condition as fades)
                    arrowLeft.classList.toggle("visible", showLeft);
                    arrowRight.classList.toggle("visible", showRight);
                }

                scrollableContent.addEventListener("scroll", updateFadeVisibility);
                window.addEventListener("resize", updateFadeVisibility);
                document.addEventListener("DOMContentLoaded", updateFadeVisibility);

            </script>

        </div>


    </div>
    <script>
        document.getElementById("downloadCSV").addEventListener("click", function () {
            const office = document.getElementById("office").value;
            const year = document.getElementById("year").value;

            // Construct the URL with query parameters for filtering
            const url = `/export_accommodation_emissions_csv?office=${encodeURIComponent(office)}&year=${encodeURIComponent(year)}`;

            // Redirect to the URL to initiate the download
            window.location.href = url;
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let currentPath = window.location.pathname;
            let sidebarLinks = document.querySelectorAll(".nav-link");

            sidebarLinks.forEach(link => {
                if (link.getAttribute("href") === currentPath) {
                    link.classList.add("active");
                }
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let currentPath = window.location.pathname;
            let sidebarLinks = document.querySelectorAll(".nav-link");

            sidebarLinks.forEach(link => {
                if (link.getAttribute("href") === currentPath) {
                    link.classList.add("active");

                    // If the link is inside a dropdown, open the dropdown
                    let parentCollapse = link.closest(".collapse");
                    if (parentCollapse) {
                        parentCollapse.classList.add("show");
                        let dropdownToggle = document.querySelector(`[data-bs-target="#${parentCollapse.id}"]`);
                        if (dropdownToggle) {
                            dropdownToggle.classList.add("active");
                        }

                        // Auto-scroll to the active report link
                        link.scrollIntoView({ behavior: "smooth", block: "center" });
                    }
                }
            });
        });
    </script>
    <script>
        const arrowLeft = document.getElementById("arrowLeft");
        const arrowRight = document.getElementById("arrowRight");

        function updateFadeVisibility() {
            const { scrollLeft, scrollWidth, clientWidth } = scrollableContent;

            const showLeft = scrollLeft > 0;
            const showRight = scrollLeft < scrollWidth - clientWidth - 1;

            // ðŸŒŸ Fade visibility
            fadeLeft.classList.toggle("visible", showLeft);
            fadeLeft.classList.toggle("hidden", !showLeft);
            fadeRight.classList.toggle("visible", showRight);
            fadeRight.classList.toggle("hidden", !showRight);

            // ðŸ¡„ðŸ¡† Arrow visibility (same condition as fades)
            arrowLeft.classList.toggle("visible", showLeft);
            arrowRight.classList.toggle("visible", showRight);
        }

        scrollableContent.addEventListener("scroll", updateFadeVisibility);
        window.addEventListener("resize", updateFadeVisibility);
        document.addEventListener("DOMContentLoaded", updateFadeVisibility);

        document.addEventListener('DOMContentLoaded', function () {
            const thElements = document.querySelectorAll('.table thead th');

            thElements.forEach(th => {
                th.addEventListener('mouseenter', function () {
                    const text = this.textContent.trim();
                    if (this.offsetWidth < this.scrollWidth) { // Check if text is truncated
                        const tooltip = document.createElement('div');
                        tooltip.textContent = text;
                        tooltip.classList.add('custom-tooltip');
                        document.body.appendChild(tooltip);

                        const rect = this.getBoundingClientRect();
                        tooltip.style.left = rect.left + 'px';
                        tooltip.style.top = rect.bottom + 5 + 'px'; // Position below the th
                    }
                });

                th.addEventListener('mouseleave', function () {
                    const tooltip = document.querySelector('.custom-tooltip');
                    if (tooltip) {
                        tooltip.remove();
                    }
                });
            });
        });

    </script>
    <!-- Add at the bottom of sdo_accommodation_emissions_report.html before </body> -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Handle delete form submissions
            document.querySelectorAll('.delete-form').forEach(form => {
                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    const id = this.dataset.id;

                    Swal.fire({
                        title: 'Are you sure?',
                        text: "This record will be permanently deleted!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Yes, delete it!'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            fetch(`/delete_accommodation_record/${id}`, {
                                method: 'POST'
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        Swal.fire({
                                            title: 'Deleted!',
                                            text: 'Record has been deleted.',
                                            icon: 'success',
                                            timer: 1500,
                                            showConfirmButton: false
                                        }).then(() => {
                                            location.reload();
                                        });
                                    } else {
                                        Swal.fire(
                                            'Error!',
                                            data.message || 'Failed to delete record.',
                                            'error'
                                        );
                                    }
                                });
                        }
                    });
                });
            });

            // Handle edit form submissions
            document.querySelectorAll('form[action*="edit_accommodation_record"]').forEach(form => {
                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    const formData = new FormData(this);

                    fetch(this.action, {
                        method: 'POST',
                        body: formData
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                Swal.fire({
                                    title: 'Success!',
                                    text: 'Record updated successfully',
                                    icon: 'success',
                                    timer: 1500,
                                    showConfirmButton: false
                                }).then(() => {
                                    location.reload();
                                });
                            } else {
                                Swal.fire({
                                    title: 'Error!',
                                    text: data.message || 'Failed to update record',
                                    icon: 'error',
                                    confirmButtonText: 'OK'
                                });
                            }
                        });
                });
            });
        });

        // Function to calculate accommodation emissions
        function calculateAccommodationEmissions(modalId) {
            const modal = document.getElementById(`editModal${modalId}`);
            if (!modal) return;

            const country = modal.querySelector('#country').value;
            const localOrInternational = modal.querySelector('#localOrInternational').value;
            const occupiedRooms = parseFloat(modal.querySelector('#occupiedRooms').value) || 0;
            const nightsPerRoom = parseFloat(modal.querySelector('#nightsPerRoom').value) || 0;

            // Define country factors (same as in your accommodation.html)
            const countryFactors = {
                "Philippines": 66.54, "Australia": 51.47,
                "Argentina": 77.08, "Armenia": 77.08, "Aruba": 77.08,
                "Bahamas": 18.73, "Austria": 18.73, "Bahrain": 18.73, "Bangladesh": 18.73,
                "Belarus": 18.73, "Barbados": 18.73, "Belgium": 16.04, "Belize": 16.04,
                "Benin": 16.04, "Bermuda": 16.04, "Bhutan": 16.04, "Bolivia": 16.04,
                "Bosnia and Herzegovina": 16.04, "Botswana": 16.04, "Brazil": 16.77,
                "British Indian Ocean Territory": 16.77, "British Virgin Islands": 16.77,
                "Brunei": 16.77, "Bulgaria": 16.77, "Burkina Faso": 16.77, "Burundi": 16.77,
                "Cambodia": 16.77, "Cameroon": 16.77, "Canada": 23.00, "Cape Verde": 23.00,
                "Cayman Islands": 23.00, "Central African Republic": 23.00, "Chad": 23.00,
                "Chile": 38.50, "China": 76.74, "Christmas Island": 76.74, "Cocos Islands": 76.74,
                "Colombia": 18.69, "Comoros": 18.69, "Cook Islands": 18.69, "Costa Rica": 11.10,
                "Croatia": 11.10, "Cuba": 11.10, "Curacao": 11.10, "Cyprus": 11.10,
                "Czech Republic": 53.04, "Democratic Republic of the Congo": 53.04, "Denmark": 53.04,
                "Djibouti": 53.04, "Dominica": 53.04, "East Timor": 53.04, "Ecuador": 53.04,
                "Egypt": 65.38, "El Salvador": 65.38, "Equatorial Guinea": 65.38, "Eritrea": 65.38,
                "Estonia": 65.38, "Ethiopia": 65.38, "Falkland Islands": 65.38, "Faroe Islands": 65.38,
                "Fiji": 48.99, "Finland": 48.99, "France": 8.01, "French Polynesia": 8.01,
                "Gabon": 8.01, "Gambia": 8.01, "Georgia": 8.01, "Germany": 22.57, "Ghana": 22.57,
                "Gibraltar": 22.57, "Greece": 56.63, "Greenland": 56.63, "Grenada": 56.63,
                "Guam": 56.63, "Guernsey": 56.63, "Guinea": 56.63, "Guyana": 56.63,
                "Guinea-Bissau": 56.63, "Haiti": 56.63, "Honduras": 56.63, "Hong Kong": 56.63,
                "Hungary": 84.43, "Iceland": 84.43, "India": 93.20, "Indonesia": 110.37,
                "Iran": 110.37, "Iraq": 110.37, "Ireland": 31.78, "Isle of Man": 31.78,
                "Israel": 72.60, "Italy": 26.20, "Ivory Coast": 26.20, "Jamaica": 26.20,
                "Japan": 81.86, "Jersey": 81.86, "Jordan": 80.48, "Kazakhstan": 80.48,
                "Kenya": 80.48, "Kiribati": 80.48, "Kosovo": 85.19, "Kuwait": 85.19,
                "Kyrgyzstan": 85.19, "Laos": 85.19, "Latvia": 85.19, "Lebanon": 85.19,
                "Lesotho": 85.19, "Liberia": 85.19, "Libya": 85.19, "Liechtenstein": 85.19,
                "Lithuania": 85.19, "Luxembourg": 85.19, "Macau": 85.19, "Macedonia": 109.01,
                "Madagascar": 109.01, "Malaysia": 95.94, "Maldives": 218.68, "Mali": 218.68,
                "Malta": 218.68, "Marshall Island": 218.68, "Mauritania": 218.68, "Mauritius": 218.68,
                "Mayotte": 218.68, "Mexico": 30.52, "Micronesia": 30.52, "Moldova": 30.52,
                "Monaco": 30.52, "Montenegro": 30.52, "Mongolia": 30.52, "Montserrat": 30.52,
                "Morocco": 30.52, "Mozambique": 30.52, "Myanmar": 30.52, "Namibia": 30.52,
                "Nauru": 30.52, "Nepal": 30.52, "Netherlands": 23.78, "New Caledonia": 23.78,
                "Netherlands Antilles": 23.78, "New Zealand": 11.57, "Nicaragua": 11.57,
                "Niger": 11.57, "Niue": 11.57, "Nigeria": 11.57, "North Korea": 11.57,
                "Northern Mariana Islands": 11.57, "Norway": 11.57, "Oman": 11.57, "Pakistan": 11.57,
                "Palau": 11.57, "Palestine": 11.57, "Panama": 31.72, "Papua New Guinea": 31.72,
                "Paraguay": 31.72, "Peru": 31.72, "Pitcairn": 66.54, "Poland": 39.12,
                "Portugal": 36.47, "Qatar": 165.18, "Republic of the Congo": 165.18, "Reunion": 165.18,
                "Romania": 34.16, "Russia": 34.16, "Rwanda": 37.98, "Saint Barthelemy": 37.98,
                "Saint Helena": 37.98, "Saint Kitts and Nevis": 37.98, "Saint Lucia": 37.98,
                "Saint Martin": 37.98, "Saint Pierre and Miquelon": 37.98, "Saint Vincent and the Grenadines": 37.98,
                "Samoa": 37.98, "San Marino": 37.98, "Sao Tome and Principe": 37.98, "Saudi Arabia": 156.64,
                "Senegal": 156.64, "Serbia": 156.64, "Seychelles": 156.64, "Sierra Leone": 156.64,
                "Singapore": 51.33, "Sint Maarten": 51.33, "Slovakia": 21.34, "Slovenia": 21.34,
                "Solomon Islands": 21.34, "Somalia": 21.34, "South Africa": 82.36, "South Korea": 82.36,
                "South Sudan": 82.36, "Spain": 20.07, "Sri Lanka": 20.07, "Sudan": 20.07,
                "Suriname": 20.07, "Svalbard and Jan Mayen": 20.07, "Swaziland": 20.07,
                "Sweden": 20.07, "Switzerland": 10.75, "Syria": 10.75, "Taiwan": 10.75,
                "Tajikistan": 117.82, "Tanzania": 117.82, "Thailand": 59.05, "Togo": 59.05,
                "Tokelau": 59.05, "Tonga": 59.05, "Trinidad and Tobago": 59.05, "Tunisia": 59.05,
                "Turkey": 41.77, "Turkmenistan": 41.77, "Turks and Caicos Islands": 41.77,
                "Tuvalu": 41.77, "U.S. Virgin Islands": 41.77, "Uganda": 41.77, "Ukraine": 41.77,
                "United Arab Emirates": 145.46, "United Kingdom": 18.41, "United States": 23.04,
                "Uruguay": 23.04, "Uzbekistan": 23.04, "Vanuatu": 23.04, "Vatican": 23.04,
                "Venezuela": 23.04, "Vietnam": 60.12, "Wallis and Futuna": 60.12, "Western Sahara": 60.12,
                "Yemen": 60.12, "Zambia": 60.12, "Zimbabwe": 60.12
            };


            // Get the factor for the selected country
            const factor = parseFloat(countryFactors[country]) || 0;

            // Calculate emissions
            const kgCO2 = occupiedRooms * nightsPerRoom * factor;
            const tCO2 = kgCO2 / 1000;

            // Update form fields
            modal.querySelector('#ghgEmissionKGC02e').value = kgCO2.toFixed(4);
            modal.querySelector('#ghgEmissionTC02e').value = tCO2.toFixed(4);
        }
    </script>
    </div>
    </div>

</body>

</html>